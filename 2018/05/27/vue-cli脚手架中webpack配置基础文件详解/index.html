<!doctype html><html class="theme-next pisces use-motion" lang=zh-CN><head><meta name=generator content="Hexo 3.8.0"><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=theme-color content=#222><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/256cc8bd.js","daovoice"),daovoice("init",{app_id:"256cc8bd"}),daovoice("update")</script><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel=stylesheet><meta http-equiv=Cache-Control content=no-transform><meta http-equiv=Cache-Control content=no-siteapp><meta name=google-site-verification content=sNI58_0qBlj048P3M9VIK0edTYQ9zf2quRwRS7aNr2w><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel=stylesheet><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel=stylesheet><link href="/css/main.css?v=6.5.0" rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href="//avatars2.githubusercontent.com/u/24365000?s=460&v=4?v=6.5.0"><link rel=icon type=image/png sizes=32x32 href="//avatars2.githubusercontent.com/u/24365000?s=460&v=4?v=6.5.0"><link rel=icon type=image/png sizes=16x16 href="//avatars2.githubusercontent.com/u/24365000?s=460&v=4?v=6.5.0"><script id=hexo.configurations>var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"6.5.0",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!0,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"QPWKMZHLRX",apiKey:"2e8005a9fbd9bc631168be460716385a",indexName:"kingmui",hits:{per_page:10},labels:{input_placeholder:"输入关键字",hits_empty:"没有找到与 「${query}」 相关的内容",hits_stats:"共找到${hits}条相关记录，耗时 ${time} ms"}}}</script><meta name=description content="vue-cli是构建vue单页应用的脚手架，输入一串指定的命令行从而自动生成vue.js+wepack的项目模板。这其中webpack发挥了很大的作用，它使得我们的代码模块化，引入一些插件帮我们完善功能，例如可以将文件打包压缩，图片转base64等。 主体结构1234567891011121314151617181920212223.├── build/"><meta name=keywords content=Vue,webpack><meta property=og:type content=article><meta property=og:title content=vue-cli脚手架中webpack配置基础文件详解><meta property=og:url content=http://www.kingmui.cn/2018/05/27/vue-cli脚手架中webpack配置基础文件详解/index.html><meta property=og:site_name content=梦里有诗和远方><meta property=og:description content="vue-cli是构建vue单页应用的脚手架，输入一串指定的命令行从而自动生成vue.js+wepack的项目模板。这其中webpack发挥了很大的作用，它使得我们的代码模块化，引入一些插件帮我们完善功能，例如可以将文件打包压缩，图片转base64等。 主体结构1234567891011121314151617181920212223.├── build/"><meta property=og:locale content=zh-CN><meta property=og:updated_time content=2019-04-05T11:06:59.575Z><meta name=twitter:card content=summary><meta name=twitter:title content=vue-cli脚手架中webpack配置基础文件详解><meta name=twitter:description content="vue-cli是构建vue单页应用的脚手架，输入一串指定的命令行从而自动生成vue.js+wepack的项目模板。这其中webpack发挥了很大的作用，它使得我们的代码模块化，引入一些插件帮我们完善功能，例如可以将文件打包压缩，图片转base64等。 主体结构1234567891011121314151617181920212223.├── build/"><link rel=alternate href=/atom.xml title=梦里有诗和远方 type=application/atom+xml><link rel=canonical href=http://www.kingmui.cn/2018/05/27/vue-cli脚手架中webpack配置基础文件详解/ ><script id=page.configurations>CONFIG.page={sidebar:""}</script><title>vue-cli脚手架中webpack配置基础文件详解 | 梦里有诗和远方</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-116303188-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-116303188-1")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?65b6c252e87243b9ea8427abb6b8cf3e";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-CN><div class="container sidebar-position-left page-post-detail"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-wrapper><div class=site-meta><div class=custom-logo-site-title><a href=/ class=brand rel=start><span class=logo-line-before><i></i></span> <span class=site-title>梦里有诗和远方</span><span class=logo-line-after><i></i></span></a></div><h1 class=site-subtitle itemprop=description>用艺术的眼光发现技术的美</h1></div><div class=site-nav-toggle><button aria-label=切换导航栏><span class=btn-bar></span><span class=btn-bar></span><span class=btn-bar></span></button></div></div><nav class=site-nav><ul id=menu class=menu><li class="menu-item menu-item-home"><a href=/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签<span class=badge>15</span></a></li><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="menu-item-icon fa fa-fw fa-file-archive-o"></i><br>归档<span class=badge>23</span></a></li><li class="menu-item menu-item-resume"><a href=/resume rel=section><i class="menu-item-icon fa fa-fw fa-user-secret"></i><br>简历</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class=site-search><div class="algolia-popup popup search-popup"><div class=algolia-search><div class=algolia-search-input-icon><i class="fa fa-search"></i></div><div class=algolia-search-input id=algolia-search-input></div></div><div class=algolia-results><div id=algolia-stats></div><div id=algolia-hits></div><div id=algolia-pagination class=algolia-pagination></div></div><span class=popup-btn-close><i class="fa fa-times-circle"></i></span></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><div id=posts class=posts-expand><div class=reading-progress-bar></div><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><div class=post-block><link itemprop=mainEntityOfPage href=http://www.kingmui.cn/2018/05/27/vue-cli脚手架中webpack配置基础文件详解/ ><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=name content="King Mui"><meta itemprop=description content=原来我和我的影子都在偷偷的哭泣><meta itemprop=image content="//avatars2.githubusercontent.com/u/24365000?s=460&v=4"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content=梦里有诗和远方></span><header class=post-header><h2 class=post-title itemprop="name headline">vue-cli脚手架中webpack配置基础文件详解</h2><div class=post-meta><span class=post-time><span class=post-meta-item-icon><i class="fa fa-calendar-o"></i></span> <span class=post-meta-item-text>发表于</span> <time title="创建时间：2018-05-27 14:06:34" itemprop="dateCreated datePublished" datetime=2018-05-27T14:06:34+08:00>2018-05-27</time> <span class=post-meta-divider>|</span><span class=post-meta-item-icon><i class="fa fa-calendar-check-o"></i></span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2019-04-05 19:06:59" itemprop=dateModified datetime=2019-04-05T19:06:59+08:00>2019-04-05</time></span> <span class=post-meta-divider>|</span><span class=post-meta-item-icon><i class="fa fa-eye"></i> 阅读次数：<span class=busuanzi-value id=busuanzi_value_page_pv></span></span></div></header><div class=post-body itemprop=articleBody><div class="note info"><p>vue-cli是构建vue单页应用的脚手架，输入一串指定的命令行从而自动生成vue.js+wepack的项目模板。这其中webpack发挥了很大的作用，它使得我们的代码模块化，引入一些插件帮我们完善功能，例如可以将文件打包压缩，图片转base64等。</p></div><h3 id=主体结构><a href=#主体结构 class=headerlink title=主体结构></a>主体结构</h3><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br></pre></td><td class=code><pre><span class=line>.</span><br><span class=line>├── build/                      <span class=comment># webpack 配置文件</span></span><br><span class=line>│   └── ...</span><br><span class=line>├── config/</span><br><span class=line>│   ├── index.js                <span class=comment># 项目配置</span></span><br><span class=line>│   └── ...</span><br><span class=line>├── src/</span><br><span class=line>│   ├── main.js                 <span class=comment># 应用入口文件</span></span><br><span class=line>│   ├── App.vue                 <span class=comment># 主应用程序组件</span></span><br><span class=line>│   ├── components/             <span class=comment># ui 组件</span></span><br><span class=line>│   │   └── ...</span><br><span class=line>│   └── assets/                 <span class=comment># 模块资源</span></span><br><span class=line>│       └── ...</span><br><span class=line>├── static/                     <span class=comment># 静态资源</span></span><br><span class=line>├── .babelrc                    <span class=comment># babel 配置</span></span><br><span class=line>├── .editorconfig               <span class=comment># 缩进，空格/制表符和编辑器的设置</span></span><br><span class=line>├── .eslintrc.js                <span class=comment># eslint 配置</span></span><br><span class=line>├── .eslintignore               <span class=comment># eslint 忽略规则</span></span><br><span class=line>├── .gitignore                  <span class=comment># gitignore</span></span><br><span class=line>├── .postcssrc.js               <span class=comment># postcss 配置</span></span><br><span class=line>├── index.html                  <span class=comment># index.html 模板</span></span><br><span class=line>├── package.json                <span class=comment># 构建脚本和依赖关系</span></span><br><span class=line>└── README.md                   <span class=comment># README file</span></span><br></pre></td></tr></table></figure><a id=more></a><h4 id=package-json><a href=#package-json class=headerlink title=package.json></a>package.json</h4><p>项目作为一个大家庭，每个文件都各司其职。package.json来制定名单，需要哪些npm包来参与到项目中来，npm install命令根据这个配置文件增减来管理本地的安装包。</p><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br></pre></td><td class=code><pre><span class=line>&#123;</span><br><span class=line>  <span class=comment>//从name到private都是package的配置信息，即我们在脚手架搭建中输入的项目描述</span></span><br><span class=line>  <span class=string>"name"</span>: <span class=string>"my-project"</span>, <span class=comment>//项目名：不能以 . (点) 或 _ (下划线)开头，不能包含大写字母</span></span><br><span class=line>  <span class=string>"version"</span>: <span class=string>"1.0.0"</span>, <span class=comment>//项目版本号：遵循"大版本.次要版本.小版本"</span></span><br><span class=line>  <span class=string>"description"</span>: <span class=string>"A Vue.js project"</span>, <span class=comment>//项目描述</span></span><br><span class=line>  <span class=string>"author"</span>: <span class=string>"kingmui &lt;muikinghk@yahoo.com.hk&gt;"</span>, <span class=comment>//作者名字</span></span><br><span class=line>  <span class=string>"private"</span>: <span class=literal>true</span>, <span class=comment>//是否私有</span></span><br><span class=line>  <span class=comment>// scripts中的子项即我们在终端运行的脚本的缩写</span></span><br><span class=line>  <span class=string>"scripts"</span>: &#123;</span><br><span class=line>    <span class=comment>// webpack-dev-server：启动http服务器，实现实时编译</span></span><br><span class=line>    <span class=comment>// inline模式会在webpack.config.js入口配置中新增webpack-dev-server/client?http://localhost:8080/的入口,使得我们访问路径为localhost:8080/index.html（相应的还有另外一种模式Iframe）</span></span><br><span class=line>    <span class=comment>// progress：显示打包的进度</span></span><br><span class=line>    <span class=string>"dev"</span>: <span class=string>"webpack-dev-server --inline --progress --config build/webpack.dev.conf.js"</span>,</span><br><span class=line>    <span class=string>"start"</span>: <span class=string>"npm run dev"</span>,</span><br><span class=line>    <span class=string>"lint"</span>: <span class=string>"eslint --ext .js,.vue src"</span>,</span><br><span class=line>    <span class=string>"build"</span>: <span class=string>"node build/build.js"</span></span><br><span class=line>  &#125;,</span><br><span class=line>  <span class=comment>// dependencies(项目依赖库):在安装时使用--save则写入到dependencies</span></span><br><span class=line>  <span class=string>"dependencies"</span>: &#123;</span><br><span class=line>    <span class=string>"vue"</span>: <span class=string>"^2.5.2"</span>,</span><br><span class=line>    <span class=string>"vue-router"</span>: <span class=string>"^3.0.1"</span></span><br><span class=line>  &#125;,</span><br><span class=line>  <span class=comment>// devDependencies(开发依赖库)：在安装时使用--save-dev则写入到devDependencies</span></span><br><span class=line>  <span class=string>"devDependencies"</span>: &#123;</span><br><span class=line>    <span class=string>"autoprefixer"</span>: <span class=string>"^7.1.2"</span>, <span class=comment>// autoprefixer作为postcss插件用来为CSS补充前缀</span></span><br><span class=line>    <span class=comment>//以下几个babel开头的都是针对es6解析的插件</span></span><br><span class=line>    <span class=string>"babel-core"</span>: <span class=string>"^6.22.1"</span>, <span class=comment>//将 js 代码分析成 ast ，方便各个插件分析语法进行相应的处理</span></span><br><span class=line>    <span class=string>"babel-eslint"</span>: <span class=string>"^8.2.1"</span>,</span><br><span class=line>    <span class=string>"babel-helper-vue-jsx-merge-props"</span>: <span class=string>"^2.0.3"</span>, <span class=comment>//预制babel-template函数，提供给vue,jsx等使用</span></span><br><span class=line>    <span class=string>"babel-loader"</span>: <span class=string>"^7.1.1"</span>, <span class=comment>//使项目运行使用Babel和webpack来传输js文件，使用babel-core提供的api进行转译</span></span><br><span class=line>    <span class=string>"babel-plugin-syntax-jsx"</span>: <span class=string>"^6.18.0"</span>, <span class=comment>//支持jsx</span></span><br><span class=line>    <span class=string>"babel-plugin-transform-runtime"</span>: <span class=string>"^6.22.0"</span>, <span class=comment>//避免编译输出中的重复，直接编译到build环境中</span></span><br><span class=line>    <span class=string>"babel-plugin-transform-vue-jsx"</span>: <span class=string>"^3.5.0"</span>, <span class=comment>// babel转译过程中使用到的插件，避免重复</span></span><br><span class=line>    <span class=string>"babel-preset-env"</span>: <span class=string>"^1.3.2"</span>, <span class=comment>//转为es5，transform阶段使用到的插件之一</span></span><br><span class=line>    <span class=string>"babel-preset-stage-2"</span>: <span class=string>"^6.22.0"</span>, <span class=comment>//ECMAScript第二阶段的规范</span></span><br><span class=line>    <span class=string>"chalk"</span>: <span class=string>"^2.0.1"</span>, <span class=comment>//在命令行输出不同颜色的文字</span></span><br><span class=line>    <span class=string>"copy-webpack-plugin"</span>: <span class=string>"^4.0.1"</span>, <span class=comment>//拷贝资源和文件</span></span><br><span class=line>    <span class=string>"css-loader"</span>: <span class=string>"^0.28.0"</span>, <span class=comment>// webpack先用css-loader加载器去解析后缀为css的文件，再使用style-loader生成一个内容为最终解析完的css代码的style标签，放到head标签里</span></span><br><span class=line>    <span class=string>"eslint"</span>: <span class=string>"^4.15.0"</span>,</span><br><span class=line>    <span class=string>"eslint-config-airbnb-base"</span>: <span class=string>"^11.3.0"</span>,</span><br><span class=line>    <span class=string>"eslint-friendly-formatter"</span>: <span class=string>"^3.0.0"</span>,</span><br><span class=line>    <span class=string>"eslint-import-resolver-webpack"</span>: <span class=string>"^0.8.3"</span>,</span><br><span class=line>    <span class=string>"eslint-loader"</span>: <span class=string>"^1.7.1"</span>,</span><br><span class=line>    <span class=string>"eslint-plugin-import"</span>: <span class=string>"^2.7.0"</span>,</span><br><span class=line>    <span class=string>"eslint-plugin-vue"</span>: <span class=string>"^4.0.0"</span>,</span><br><span class=line>    <span class=string>"extract-text-webpack-plugin"</span>: <span class=string>"^3.0.0"</span>, <span class=comment>//将一个以上的包里面的文本提取到单独文件中</span></span><br><span class=line>    <span class=string>"file-loader"</span>: <span class=string>"^1.1.4"</span>, <span class=comment>//打包压缩文件，与url-loader用法类似</span></span><br><span class=line>    <span class=string>"friendly-errors-webpack-plugin"</span>: <span class=string>"^1.6.1"</span>, <span class=comment>//识别某些类别的WebPACK错误和清理，聚合和优先排序，以提供更好的开发经验</span></span><br><span class=line>    <span class=string>"html-webpack-plugin"</span>: <span class=string>"^2.30.1"</span>, <span class=comment>//简化了HTML文件的创建，引入了外部资源，创建html的入口文件，可通过此项进行多页面的配置</span></span><br><span class=line>    <span class=string>"node-notifier"</span>: <span class=string>"^5.1.2"</span>, <span class=comment>//支持使用node发送跨平台的本地通知</span></span><br><span class=line>    <span class=string>"optimize-css-assets-webpack-plugin"</span>: <span class=string>"^3.2.0"</span>, <span class=comment>//压缩提取出的css，并解决ExtractTextPlugin分离出的js重复问题(多个文件引入同一css文件)</span></span><br><span class=line>    <span class=string>"ora"</span>: <span class=string>"^1.2.0"</span>, <span class=comment>//加载(loading)的插件</span></span><br><span class=line>    <span class=string>"portfinder"</span>: <span class=string>"^1.0.13"</span>, <span class=comment>//查看进程端口</span></span><br><span class=line>    <span class=string>"postcss-import"</span>: <span class=string>"^11.0.0"</span>, <span class=comment>//可以消耗本地文件、节点模块或web_modules</span></span><br><span class=line>    <span class=string>"postcss-loader"</span>: <span class=string>"^2.0.8"</span>, <span class=comment>//用来兼容css的插件</span></span><br><span class=line>    <span class=string>"postcss-url"</span>: <span class=string>"^7.2.1"</span>, <span class=comment>// URL上重新定位、内联或复制</span></span><br><span class=line>    <span class=string>"rimraf"</span>: <span class=string>"^2.6.0"</span>, <span class=comment>//节点的Unix命令RM—RF,强制删除文件或者目录的命令</span></span><br><span class=line>    <span class=string>"semver"</span>: <span class=string>"^5.3.0"</span>, <span class=comment>//用来对特定的版本号做判断的</span></span><br><span class=line>    <span class=string>"shelljs"</span>: <span class=string>"^0.7.6"</span>, <span class=comment>//使用它来消除shell脚本在Unix上的依赖性，同时仍然保留其熟悉和强大的命令，即可执行Unix系统命令</span></span><br><span class=line>    <span class=string>"uglifyjs-webpack-plugin"</span>: <span class=string>"^1.1.1"</span>, <span class=comment>//压缩js文件</span></span><br><span class=line>    <span class=string>"url-loader"</span>: <span class=string>"^0.5.8"</span>, <span class=comment>//压缩文件，可将图片转为base64</span></span><br><span class=line>    <span class=string>"vue-loader"</span>: <span class=string>"^13.3.0"</span>, <span class=comment>// Vue单文件组件的webpack加载器</span></span><br><span class=line>    <span class=string>"vue-style-loader"</span>: <span class=string>"^3.0.1"</span>, <span class=comment>//类似于样式加载程序，您可以在CSS加载器之后将其链接，以将CSS动态地注入到文档中作为样式标签</span></span><br><span class=line>    <span class=string>"vue-template-compiler"</span>: <span class=string>"^2.5.2"</span>, <span class=comment>//预编译Vue模板到渲染函数，以避免运行时编译开销和CSP限制</span></span><br><span class=line>    <span class=string>"webpack"</span>: <span class=string>"^3.6.0"</span>,</span><br><span class=line>    <span class=string>"webpack-bundle-analyzer"</span>: <span class=string>"^2.9.0"</span>, <span class=comment>//可视化webpack输出文件的大小</span></span><br><span class=line>    <span class=string>"webpack-dev-server"</span>: <span class=string>"^2.9.1"</span>, <span class=comment>//提供一个热重载的开发服务器</span></span><br><span class=line>    <span class=string>"webpack-merge"</span>: <span class=string>"^4.1.0"</span> <span class=comment>//它将数组和合并对象创建一个新对象。如果遇到函数，它将执行它们，通过算法运行结果，然后再次将返回的值封装在函数中</span></span><br><span class=line>  &#125;,</span><br><span class=line>  <span class=comment>// 指定node和npm版本</span></span><br><span class=line>  <span class=string>"engines"</span>: &#123;</span><br><span class=line>    <span class=string>"node"</span>: <span class=string>"&gt;= 6.0.0"</span>,</span><br><span class=line>    <span class=string>"npm"</span>: <span class=string>"&gt;= 3.0.0"</span></span><br><span class=line>  &#125;,</span><br><span class=line>  <span class=comment>//限制了浏览器或者客户端需要什么版本才可运行</span></span><br><span class=line>  <span class=string>"browserslist"</span>: [</span><br><span class=line>    <span class=string>"&gt; 1%"</span>,</span><br><span class=line>    <span class=string>"last 2 versions"</span>,</span><br><span class=line>    <span class=string>"not ie &lt;= 8"</span></span><br><span class=line>  ]</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>devDependencies和dependencies的区别</strong><br>devDependencies里面的插件只用于开发环境，不用于生产环境，即辅助作用，打包的时候需要，打包完成就不需要了。而dependencies是需要发布到生产环境的，自始至终都在。比如wepack等只是在开发中使用的包就写入到devDependencies，而像vue这种项目全程依赖的包要写入到dependencies。</li><li><strong>file-loader和url-loader的区别</strong><br>以图片为例，<span class=exturl data-url="aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZmlsZS1sb2FkZXI=" title=https://www.npmjs.com/package/file-loader>file-loader<i class="fa fa-external-link"></i></span>可对图片进行压缩，但是还是通过文件路径进行引入，当http请求增多时会降低页面性能，而<span class=exturl data-url="aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvdXJsLWxvYWRlcg==" title=https://www.npmjs.com/package/url-loader>url-loader<i class="fa fa-external-link"></i></span>通过设定limit参数，小于limit字节的图片会被转成base64的文件，大于limit字节的将进行图片压缩的操作。总而言之，url-loader是file-loader的上层封装。</li></ol><h4 id=postcssrc-js><a href=#postcssrc-js class=headerlink title=.postcssrc.js></a><span class=exturl data-url="aHR0cHM6Ly9naXRodWIuY29tL21pY2hhZWwtY2luaWF3c2t5L3Bvc3Rjc3MtbG9hZC1jb25maWc=" title=https://github.com/michael-ciniawsky/postcss-load-config>.postcssrc.js<i class="fa fa-external-link"></i></span></h4><p>.postcssrc.js文件其实是postcss-loader包的一个配置，在webpack的旧版本可以直接在webpack.config.js中配置，现版本中postcss的文档示例独立出.postcssrc.js，里面写进去需要使用到的插件</p><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line><span class=built_in>module</span>.exports = &#123;</span><br><span class=line>  <span class=string>"plugins"</span>: &#123;</span><br><span class=line>    <span class=string>"postcss-import"</span>: &#123;&#125;,</span><br><span class=line>    <span class=string>"postcss-url"</span>: &#123;&#125;,</span><br><span class=line>    <span class=comment>// to edit target browsers: use "browserslist" field in package.json</span></span><br><span class=line>    <span class=string>"autoprefixer"</span>: &#123;&#125;</span><br><span class=line>  &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p><span class=exturl data-url="aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcG9zdGNzcy1pbXBvcnQ=" title=https://www.npmjs.com/package/postcss-import>postcss-import<i class="fa fa-external-link"></i></span>文档传送门<br><span class=exturl data-url="aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcG9zdGNzcy11cmw=" title=https://www.npmjs.com/package/postcss-url>postcss-url<i class="fa fa-external-link"></i></span>文档传送门<br><span class=exturl data-url=aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvYXV0b3ByZWZpeGVy title=https://www.npmjs.com/package/autoprefixer>autoprefixer<i class="fa fa-external-link"></i></span>文档传送门</p><h4 id=babelrc><a href=#babelrc class=headerlink title=.babelrc></a>.babelrc</h4><p>该文件是es6解析的一个配置</p><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre></td><td class=code><pre><span class=line>&#123;</span><br><span class=line>  <span class=comment>//制定转码的规则</span></span><br><span class=line>  <span class=string>"presets"</span>: [</span><br><span class=line>    <span class=comment>//env是使用babel-preset-env插件将js进行转码成es5，并且设置不转码的AMD,COMMONJS的模块文件，制定浏览器的兼容</span></span><br><span class=line>    [<span class=string>"env"</span>, &#123;</span><br><span class=line>      <span class=string>"modules"</span>: <span class=literal>false</span>,</span><br><span class=line>      <span class=string>"targets"</span>: &#123;</span><br><span class=line>        <span class=string>"browsers"</span>: [<span class=string>"&gt; 1%"</span>, <span class=string>"last 2 versions"</span>, <span class=string>"not ie &lt;= 8"</span>]</span><br><span class=line>      &#125;</span><br><span class=line>    &#125;],</span><br><span class=line>    <span class=string>"stage-2"</span></span><br><span class=line>  ],</span><br><span class=line>  <span class=string>"plugins"</span>: [<span class=string>"transform-vue-jsx"</span>, <span class=string>"transform-runtime"</span>]</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p><span class=exturl data-url=aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvYmFiZWwtcGx1Z2luLXRyYW5zZm9ybS12dWUtanN4 title=https://www.npmjs.com/package/babel-plugin-transform-vue-jsx>transform-vue-jsx<i class="fa fa-external-link"></i></span>文档传送门<br><span class=exturl data-url=aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvYmFiZWwtcGx1Z2luLXRyYW5zZm9ybS1ydW50aW1l title=https://www.npmjs.com/package/babel-plugin-transform-runtime>transform-runtime<i class="fa fa-external-link"></i></span>文档传送门</p><h4 id=src内文件><a href=#src内文件 class=headerlink title=src内文件></a>src内文件</h4><p>我们开发的代码都存放在src目录下，根据需要我们通常会再建一些文件夹。比如pages文件夹，用来存放页面；components文件夹，用来存放组件；api文件夹，封装请求的参数和方法；store文件夹，使用vuex来作为vue的状态管理工具。</p><p>① assets文件夹：在里面建立js、css、images、fonts等文件夹，作为静态资源调用</p><p>② components文件夹：用于存放组件，合理地使用组件可以高效地实现复用等功能，从而更好地开发项目。一般情况下比如创建头部组件的时候，我们会新建一个header的文件夹，然后再新建一个header.vue的文件</p><p>③ router文件夹：该文件夹下有一个叫index.js文件，用于实现页面的路由跳转，具体使用请查看<span class=exturl data-url="aHR0cHM6Ly9yb3V0ZXIudnVlanMub3JnL3poLw==" title=https://router.vuejs.org/zh/ >vue-router<i class="fa fa-external-link"></i></span></p><p>④ App.vue：作为我们的主组件，可通过使用<router-view>开放入口让其他的页面组件得以显示</router-view></p><p>⑤ main.js：作为我们的入口文件，主要作用是初始化vue实例并使用需要的插件，小型项目省略router时可放在该处</p><h4 id=其他文件><a href=#其他文件 class=headerlink title=其他文件></a>其他文件</h4><p>① .editorconfig：编辑器的配置文件</p><p>② .gitignore：忽略git提交的一个文件，配置之后提交时将不会加载忽略的文件</p><p>③ index.html：页面入口，经过编译之后的代码将插入到这来</p><p>④ package.lock.json：锁定安装时的包的版本号，并且需要上传到git，以保证其他人在npm install时大家的依赖能保持一致</p><p>⑤ README.md：在此填写项目介绍</p><p>⑥ node_modules：根据package.json安装时候生成的的依赖</p><h3 id=config文件夹><a href=#config文件夹 class=headerlink title=config文件夹></a>config文件夹</h3><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line>├─config </span><br><span class=line>│ ├─dev.env.js</span><br><span class=line>│ ├─index.js</span><br><span class=line>│ ├─prod.env.js</span><br></pre></td></tr></table></figure><h4 id=dev-env-js><a href=#dev-env-js class=headerlink title=dev.env.js></a>dev.env.js</h4><p>该文件主要用来设置开发环境变量。</p><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line><span class=meta>'use strict'</span></span><br><span class=line><span class=keyword>const</span> merge = <span class=built_in>require</span>(<span class=string>'webpack-merge'</span>)</span><br><span class=line><span class=keyword>const</span> prodEnv = <span class=built_in>require</span>(<span class=string>'./prod.env'</span>)</span><br><span class=line><span class=comment>// 配置NODE_ENV来决定开发环境</span></span><br><span class=line><span class=comment>// 这个就是用来上线的时候用到，来决定是开发环境还是生产环境，来进行相关的配置解决方案</span></span><br><span class=line><span class=built_in>module</span>.exports = merge(prodEnv, &#123;</span><br><span class=line>  NODE_ENV: <span class=string>'"development"'</span></span><br><span class=line>&#125;)</span><br></pre></td></tr></table></figure><p><span class=exturl data-url="aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvd2VicGFjay1tZXJnZQ==" title=https://www.npmjs.com/package/webpack-merge>webpack-merge<i class="fa fa-external-link"></i></span>文档传送门</p><h4 id=prod-env-js><a href=#prod-env-js class=headerlink title=prod.env.js></a>prod.env.js</h4><p>该文件主要用来设置生产环境变量。</p><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line><span class=meta>'use strict'</span></span><br><span class=line><span class=comment>// NODE_ENV决定生产环境</span></span><br><span class=line><span class=built_in>module</span>.exports = &#123;</span><br><span class=line>  NODE_ENV: <span class=string>'"production"'</span></span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h4 id=index-js><a href=#index-js class=headerlink title=index.js></a>index.js</h4><p>config文件夹下，最主要的就是index.js文件，保存着开发环境和生产环境所需要的信息。</p><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br></pre></td><td class=code><pre><span class=line><span class=meta>'use strict'</span></span><br><span class=line><span class=comment>// see http://vuejs-templates.github.io/webpack for documentation.</span></span><br><span class=line><span class=keyword>const</span> path = <span class=built_in>require</span>(<span class=string>'path'</span>)</span><br><span class=line></span><br><span class=line><span class=built_in>module</span>.exports = &#123;</span><br><span class=line>  <span class=comment>// 开发环境下的配置</span></span><br><span class=line>  dev: &#123;</span><br><span class=line>    <span class=comment>// 二级目录，存放静态资源文件的目录，位于dist文件夹下</span></span><br><span class=line>    assetsSubDirectory: <span class=string>'static'</span>,</span><br><span class=line>    <span class=comment>// 发布路径，如果构建后的产品文件有用于CDN或者放到其他域名服务器，可以在这里设置，当然本地打包，本地浏览一般都将这里设置为"./"</span></span><br><span class=line>    <span class=comment>// 设置之后的构建的产品在注入到index.html中就会带上这里的发布路径</span></span><br><span class=line>    assetsPublicPath: <span class=string>'/'</span>,</span><br><span class=line>    <span class=comment>// 代理示例： proxy: [&#123;context: ["/auth", "/api"],target: "http://localhost:3000",&#125;]</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-proxy</span></span><br><span class=line>    proxyTable: &#123;&#125;, <span class=comment>//可利用该属性解决跨域的问题</span></span><br><span class=line></span><br><span class=line>    <span class=comment>// 各种Dev服务器设置</span></span><br><span class=line>    host: <span class=string>'localhost'</span>, <span class=comment>// 可以被process.env.HOST重写</span></span><br><span class=line>    port: <span class=number>8080</span>, <span class=comment>// 可以被process.env.PORT重写，如果端口号占用出现问题可在此处修改</span></span><br><span class=line>    autoOpenBrowser: <span class=literal>false</span>, <span class=comment>//是否在编译（输入命令行npm run dev）后打开http://localhost:8080/页面</span></span><br><span class=line>    <span class=comment>// 当出现编译器错误或警告时，在浏览器中显示全屏叠加,覆盖到浏览器的项目页面的上方</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-overlay</span></span><br><span class=line>    errorOverlay: <span class=literal>true</span>,</span><br><span class=line>    <span class=comment>// 是否允许窗口弹出错误信息</span></span><br><span class=line>    <span class=comment>// 传送门:https://www.npmjs.com/package/node-notifier</span></span><br><span class=line>    notifyOnErrors: <span class=literal>true</span>,</span><br><span class=line>    <span class=comment>// webpack使用文件系统(file system)获取文件改动的通知--devServer.watchOptions </span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-watchoptions-</span></span><br><span class=line>    poll: <span class=literal>false</span>,</span><br><span class=line></span><br><span class=line>    <span class=comment>// Use Eslint Loader?</span></span><br><span class=line>    <span class=comment>// If true, your code will be linted during bundling and</span></span><br><span class=line>    <span class=comment>// linting errors and warnings will be shown in the console.</span></span><br><span class=line>    useEslint: <span class=literal>true</span>,</span><br><span class=line>    <span class=comment>// 如果使用了eslint，违反eslint规则的错误和警告也将被显示在浏览器的透明黑色层上面</span></span><br><span class=line>    showEslintErrorsInOverlay: <span class=literal>false</span>,</span><br><span class=line></span><br><span class=line>    <span class=comment>/**</span></span><br><span class=line><span class=comment>     * Source Maps</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line></span><br><span class=line>    <span class=comment>// 开启调试的类型</span></span><br><span class=line>    <span class=comment>//传送门: https://webpack.js.org/configuration/devtool/#development</span></span><br><span class=line>    devtool: <span class=string>'cheap-module-eval-source-map'</span>,</span><br><span class=line></span><br><span class=line>    <span class=comment>// If you have problems debugging vue-files in devtools,</span></span><br><span class=line>    <span class=comment>// set this to false - it *may* help</span></span><br><span class=line>    <span class=comment>// 是否通过将哈希查询附加到文件名来生成具有缓存清除的源映射</span></span><br><span class=line>    <span class=comment>// https://vue-loader.vuejs.org/en/options.html#cachebusting</span></span><br><span class=line>    cacheBusting: <span class=literal>true</span>,</span><br><span class=line>    <span class=comment>//代码压缩后进行调bug定位将非常困难，于是引入sourcemap记录压缩前后的位置信息记录，当产生错误时直接定位到未压缩前的位置，将大大的方便我们调试</span></span><br><span class=line>    cssSourceMap: <span class=literal>true</span></span><br><span class=line>  &#125;,</span><br><span class=line></span><br><span class=line>  <span class=comment>// 生产环境下的配置</span></span><br><span class=line>  build: &#123;</span><br><span class=line>    <span class=comment>// Template for index.html</span></span><br><span class=line>    <span class=comment>// index编译后生成的位置和名字，根据需要改变后缀，比如index.php</span></span><br><span class=line>    index: path.resolve(__dirname, <span class=string>'../dist/index.html'</span>),</span><br><span class=line></span><br><span class=line>    <span class=comment>// Paths</span></span><br><span class=line>    <span class=comment>//编译后存放生成环境代码的位置</span></span><br><span class=line>    assetsRoot: path.resolve(__dirname, <span class=string>'../dist'</span>),</span><br><span class=line>    <span class=comment>// 二级目录</span></span><br><span class=line>    assetsSubDirectory: <span class=string>'static'</span>,</span><br><span class=line>    assetsPublicPath: <span class=string>'/'</span>,</span><br><span class=line></span><br><span class=line>    <span class=comment>/**</span></span><br><span class=line><span class=comment>     * Source Maps</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=comment>// production环境下生成sourceMap文件</span></span><br><span class=line>    <span class=comment>// 传送门:https://webpack.js.org/configuration/devtool/#production</span></span><br><span class=line>    productionSourceMap: <span class=literal>true</span>,</span><br><span class=line>    <span class=comment>// 开启调试的类型</span></span><br><span class=line>    <span class=comment>// https://webpack.docschina.org/configuration/devtool</span></span><br><span class=line>    devtool: <span class=string>'#source-map'</span>,</span><br><span class=line></span><br><span class=line>    <span class=comment>// Gzip off by default as many popular static hosts such as</span></span><br><span class=line>    <span class=comment>// Surge or Netlify already gzip all static assets for you.</span></span><br><span class=line>    <span class=comment>// Before setting to `true`, make sure to:</span></span><br><span class=line>    <span class=comment>// npm install --save-dev compression-webpack-plugin</span></span><br><span class=line>    <span class=comment>// gzip模式下需要压缩的文件的扩展名，设置js、css之后就只会对js和css文件进行压缩</span></span><br><span class=line>    productionGzip: <span class=literal>false</span>,</span><br><span class=line>    productionGzipExtensions: [<span class=string>'js'</span>, <span class=string>'css'</span>],</span><br><span class=line></span><br><span class=line>    <span class=comment>// Run the build command with an extra argument to</span></span><br><span class=line>    <span class=comment>// View the bundle analyzer report after build finishes:</span></span><br><span class=line>    <span class=comment>// `npm run build --report`</span></span><br><span class=line>    <span class=comment>// Set to `true` or `false` to always turn it on or off</span></span><br><span class=line>    <span class=comment>// 是否展示webpack构建打包之后的分析报告</span></span><br><span class=line>    bundleAnalyzerReport: process.env.npm_config_report</span><br><span class=line>  &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h3 id=build文件夹><a href=#build文件夹 class=headerlink title=build文件夹></a>build文件夹</h3><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line>├─build</span><br><span class=line>│ ├─build.js</span><br><span class=line>│ ├─check-versions.js</span><br><span class=line>│ ├─utils.js</span><br><span class=line>│ ├─vue-loader.conf.js</span><br><span class=line>│ ├─webpack.base.conf.js</span><br><span class=line>│ ├─webpack.dev.conf.js</span><br><span class=line>│ ├─webpack.prod.conf.js</span><br></pre></td></tr></table></figure><h4 id=build-js><a href=#build-js class=headerlink title=build.js></a>build.js</h4><p>该文件用于构建生产版本。package.json中的scripts的build就是node build/build.js，输入命令行 <code>npm run build</code> 对该文件进行编译生成生产环境的代码。build.js主要完成下面几件事：</p><ol><li>进行node和npm的版本检查</li><li>打包时产生loading动画</li><li>删除目标文件夹</li><li>输出打包信息</li></ol><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br></pre></td><td class=code><pre><span class=line><span class=meta>'use strict'</span></span><br><span class=line><span class=comment>// 进行npm和node版本检查</span></span><br><span class=line><span class=built_in>require</span>(<span class=string>'./check-versions'</span>)()</span><br><span class=line><span class=comment>// 设置当前node的环境变量为production</span></span><br><span class=line>process.env.NODE_ENV = <span class=string>'production'</span></span><br><span class=line><span class=comment>// npm run build显示的进度条</span></span><br><span class=line><span class=comment>// 传送门：https://github.com/sindresorhus/ora</span></span><br><span class=line><span class=keyword>const</span> ora = <span class=built_in>require</span>(<span class=string>'ora'</span>)</span><br><span class=line><span class=comment>// 删除文件或文件夹</span></span><br><span class=line><span class=comment>// 传送门：https://github.com/isaacs/rimraf</span></span><br><span class=line><span class=keyword>const</span> rm = <span class=built_in>require</span>(<span class=string>'rimraf'</span>)</span><br><span class=line><span class=keyword>const</span> path = <span class=built_in>require</span>(<span class=string>'path'</span>)</span><br><span class=line><span class=keyword>const</span> chalk = <span class=built_in>require</span>(<span class=string>'chalk'</span>)</span><br><span class=line><span class=keyword>const</span> webpack = <span class=built_in>require</span>(<span class=string>'webpack'</span>)</span><br><span class=line><span class=keyword>const</span> config = <span class=built_in>require</span>(<span class=string>'../config'</span>) <span class=comment>//默认读取下面的index.js文件</span></span><br><span class=line><span class=keyword>const</span> webpackConfig = <span class=built_in>require</span>(<span class=string>'./webpack.prod.conf'</span>)</span><br><span class=line><span class=comment>// 填写打包时所显示的提示信息</span></span><br><span class=line><span class=keyword>const</span> spinner = ora(<span class=string>'building for production...'</span>)</span><br><span class=line><span class=comment>// 开启loading动画</span></span><br><span class=line>spinner.start()</span><br><span class=line><span class=comment>// 先删除dist文件再生成新文件，因为有时候会使用hash来命名，删除整个文件可避免冗余</span></span><br><span class=line>rm(path.join(config.build.assetsRoot, config.build.assetsSubDirectory), err =&gt; &#123;</span><br><span class=line>  <span class=keyword>if</span> (err) <span class=keyword>throw</span> err</span><br><span class=line>  webpack(webpackConfig, (err, stats) =&gt; &#123;</span><br><span class=line>    spinner.stop()</span><br><span class=line>    <span class=keyword>if</span> (err) <span class=keyword>throw</span> err</span><br><span class=line>    <span class=comment>// 控制打包后详细文件的输出情况</span></span><br><span class=line>    process.stdout.write(stats.toString(&#123;</span><br><span class=line>      colors: <span class=literal>true</span>,</span><br><span class=line>      modules: <span class=literal>false</span>,</span><br><span class=line>      children: <span class=literal>false</span>, <span class=comment>// If you are using ts-loader, setting this to true will make TypeScript errors show up during build.</span></span><br><span class=line>      chunks: <span class=literal>false</span>,</span><br><span class=line>      chunkModules: <span class=literal>false</span></span><br><span class=line>    &#125;) + <span class=string>'\n\n'</span>)</span><br><span class=line></span><br><span class=line>    <span class=comment>// 打包失败，显示错误信息，并退出程序</span></span><br><span class=line>    <span class=keyword>if</span> (stats.hasErrors()) &#123;</span><br><span class=line>      <span class=built_in>console</span>.log(chalk.red(<span class=string>'  Build failed with errors.\n'</span>))</span><br><span class=line>      process.exit(<span class=number>1</span>)</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    <span class=comment>// 打包成功后在控制台上显示打包成功的提示信息</span></span><br><span class=line>    <span class=built_in>console</span>.log(chalk.cyan(<span class=string>'  Build complete.\n'</span>))</span><br><span class=line>    <span class=built_in>console</span>.log(chalk.yellow(</span><br><span class=line>      <span class=string>'  Tip: built files are meant to be served over an HTTP server.\n'</span> +</span><br><span class=line>      <span class=string>'  Opening index.html over file:// won\'t work.\n'</span></span><br><span class=line>    ))</span><br><span class=line>  &#125;)</span><br><span class=line>&#125;)</span><br></pre></td></tr></table></figure><p><span class=exturl data-url=aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvb3Jh title=https://www.npmjs.com/package/ora>ora<i class="fa fa-external-link"></i></span>文档传送门<br><span class=exturl data-url="aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvY2hhbGs=" title=https://www.npmjs.com/package/chalk>chalk<i class="fa fa-external-link"></i></span>文档传送门<br><span class=exturl data-url=aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcmltcmFm title=https://www.npmjs.com/package/rimraf>rimraf<i class="fa fa-external-link"></i></span>文档传送门</p><h4 id=check-versions-js><a href=#check-versions-js class=headerlink title=check-versions.js></a>check-versions.js</h4><p>该文件用于检测node和npm的版本，实现版本依赖</p><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br></pre></td><td class=code><pre><span class=line><span class=meta>'use strict'</span></span><br><span class=line><span class=comment>// chalk插件，作用是在控制台中输出不同颜色的字，只能改变命令行中的字体颜色</span></span><br><span class=line><span class=comment>// 传送门:https://github.com/chalk/chalk</span></span><br><span class=line><span class=keyword>const</span> chalk = <span class=built_in>require</span>(<span class=string>'chalk'</span>)</span><br><span class=line><span class=comment>// npm版本号的检查</span></span><br><span class=line><span class=comment>// 传送门:https://docs.npmjs.com/misc/semver</span></span><br><span class=line><span class=keyword>const</span> semver = <span class=built_in>require</span>(<span class=string>'semver'</span>)</span><br><span class=line><span class=keyword>const</span> packageConfig = <span class=built_in>require</span>(<span class=string>'../package.json'</span>)</span><br><span class=line><span class=comment>// shelljs插件，用来执行Unix系统命令</span></span><br><span class=line><span class=keyword>const</span> shell = <span class=built_in>require</span>(<span class=string>'shelljs'</span>)</span><br><span class=line><span class=comment>//脚本可以通过child_process模块新建子进程，执行 Unix 系统命令后转成没有空格的字符串</span></span><br><span class=line><span class=function><span class=keyword>function</span> <span class=title>exec</span> (<span class=params>cmd</span>) </span>&#123;</span><br><span class=line>  <span class=keyword>return</span> <span class=built_in>require</span>(<span class=string>'child_process'</span>).execSync(cmd).toString().trim()</span><br><span class=line>&#125;</span><br><span class=line><span class=keyword>const</span> versionRequirements = [</span><br><span class=line>  &#123;</span><br><span class=line>    name: <span class=string>'node'</span>,</span><br><span class=line>    <span class=comment>// 当前node版本信息，使用semver插件把版本信息转化成规定格式</span></span><br><span class=line>    currentVersion: semver.clean(process.version), <span class=comment>// semver.clean('  =v1.2.3   ') // '1.2.3'</span></span><br><span class=line>    <span class=comment>//package.json里面所要求的node版本信息</span></span><br><span class=line>    versionRequirement: packageConfig.engines.node</span><br><span class=line>  &#125;</span><br><span class=line>]</span><br><span class=line></span><br><span class=line><span class=keyword>if</span> (shell.which(<span class=string>'npm'</span>)) &#123;</span><br><span class=line>  versionRequirements.push(&#123;</span><br><span class=line>    name: <span class=string>'npm'</span>,</span><br><span class=line>    <span class=comment>// 自动调用npm --version命令，并且把参数返回给exec函数，从而获取纯净的版本号</span></span><br><span class=line>    currentVersion: exec(<span class=string>'npm --version'</span>),</span><br><span class=line>    <span class=comment>// package.json里面所要求的npm版本信息</span></span><br><span class=line>    versionRequirement: packageConfig.engines.npm</span><br><span class=line>  &#125;)</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=built_in>module</span>.exports = <span class=function><span class=keyword>function</span> (<span class=params></span>) </span>&#123;</span><br><span class=line>  <span class=keyword>const</span> warnings = []</span><br><span class=line></span><br><span class=line>  <span class=comment>// 进行版本检查，这里主要用到semver的模块,semver.satisfies(version,range),如果版本不在这个范围内，则进行报错</span></span><br><span class=line>  <span class=keyword>for</span> (<span class=keyword>let</span> i = <span class=number>0</span>; i &lt; versionRequirements.length; i++) &#123;</span><br><span class=line>    <span class=keyword>const</span> mod = versionRequirements[i]</span><br><span class=line></span><br><span class=line>    <span class=keyword>if</span> (!semver.satisfies(mod.currentVersion, mod.versionRequirement)) &#123;</span><br><span class=line>      <span class=comment>//上面这个判断就是如果版本号不符合package.json文件中指定的版本号，就执行下面错误提示的代码</span></span><br><span class=line>      warnings.push(mod.name + <span class=string>': '</span> +</span><br><span class=line>        chalk.red(mod.currentVersion) + <span class=string>' should be '</span> +</span><br><span class=line>        chalk.green(mod.versionRequirement)</span><br><span class=line>      )</span><br><span class=line>    &#125;</span><br><span class=line>  &#125;</span><br><span class=line>  <span class=comment>// 能否正常的运行dev-server</span></span><br><span class=line>  <span class=comment>// 传送门：http://javascript.ruanyifeng.com/nodejs/process.html#toc9</span></span><br><span class=line>  <span class=comment>// process.exit方法用来退出当前进程。它可以接受一个数值参数，如果参数大于0，表示执行失败；如果等于0表示执行成功</span></span><br><span class=line>  <span class=keyword>if</span> (warnings.length) &#123;</span><br><span class=line>    <span class=built_in>console</span>.log(<span class=string>''</span>)</span><br><span class=line>    <span class=built_in>console</span>.log(chalk.yellow(<span class=string>'To use this template, you must update following to modules:'</span>))</span><br><span class=line>    <span class=built_in>console</span>.log()</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (<span class=keyword>let</span> i = <span class=number>0</span>; i &lt; warnings.length; i++) &#123;</span><br><span class=line>      <span class=keyword>const</span> warning = warnings[i]</span><br><span class=line>      <span class=built_in>console</span>.log(<span class=string>'  '</span> + warning)</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    <span class=built_in>console</span>.log()</span><br><span class=line>    process.exit(<span class=number>1</span>)</span><br><span class=line>  &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p><span class=exturl data-url=aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvc2VtdmVy title=https://www.npmjs.com/package/semver>semver<i class="fa fa-external-link"></i></span>文档传送门</p><h4 id=utils-js><a href=#utils-js class=headerlink title=utils.js></a>utils.js</h4><p>utils提供工具函数，包括生成处理各种样式语言的loader，获取资源文件存放路径的工具函数。<br>utils.js 主要完成了下面这些事件:</p><ol><li>计算资源文件存放路径</li><li>生成cssLoaders用于加载.vue文件中的样式</li><li>生成styleLoaders用于加载不在.vue文件中的单独存在的样式文件</li><li>处理程序在编译过程中出现的错误，并在桌面进行错误信息的提示</li></ol><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br></pre></td><td class=code><pre><span class=line><span class=meta>'use strict'</span></span><br><span class=line><span class=keyword>const</span> path = <span class=built_in>require</span>(<span class=string>'path'</span>)</span><br><span class=line><span class=keyword>const</span> config = <span class=built_in>require</span>(<span class=string>'../config'</span>)</span><br><span class=line><span class=comment>// extract-text-webpack-plugin可以提取bundle中的特定文本，将提取后的文本单独存放到另外的文件</span></span><br><span class=line><span class=comment>// 传送门:https://webpack.js.org/plugins/extract-text-webpack-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line><span class=keyword>const</span> ExtractTextPlugin = <span class=built_in>require</span>(<span class=string>'extract-text-webpack-plugin'</span>)</span><br><span class=line><span class=comment>// 引入包的json文件</span></span><br><span class=line><span class=keyword>const</span> packageConfig = <span class=built_in>require</span>(<span class=string>'../package.json'</span>)</span><br><span class=line><span class=comment>// 资源存放的路径，区别在于生产环境和开发环境</span></span><br><span class=line>exports.assetsPath = <span class=function><span class=keyword>function</span> (<span class=params>_path</span>) </span>&#123;</span><br><span class=line>  <span class=keyword>const</span> assetsSubDirectory = process.env.NODE_ENV === <span class=string>'production'</span></span><br><span class=line>    ? config.build.assetsSubDirectory</span><br><span class=line>    : config.dev.assetsSubDirectory</span><br><span class=line>  <span class=comment>// path.posix：提供对路径方法的POSIX（可移植性操作系统接口）特定实现的访问，即可跨平台，区别于path.win32</span></span><br><span class=line>  <span class=comment>// 传送门:https://nodejs.org/api/path.html#path_path_posix</span></span><br><span class=line>  <span class=keyword>return</span> path.posix.join(assetsSubDirectory, _path)</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line>exports.cssLoaders = <span class=function><span class=keyword>function</span> (<span class=params>options</span>) </span>&#123;</span><br><span class=line>  options = options || &#123;&#125;</span><br><span class=line>  <span class=comment>//使用了css-loader和postcssLoader，通过options.usePostCSS属性来判断是否使用postcssLoader中压缩等方法</span></span><br><span class=line>  <span class=keyword>const</span> cssLoader = &#123;</span><br><span class=line>    loader: <span class=string>'css-loader'</span>,</span><br><span class=line>    options: &#123;</span><br><span class=line>      <span class=comment>// 是否使用sourceMap</span></span><br><span class=line>      <span class=comment>// 传送门 :https://webpack.js.org/loaders/css-loader/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line>      sourceMap: options.sourceMap</span><br><span class=line>    &#125;</span><br><span class=line>  &#125;</span><br><span class=line></span><br><span class=line>  <span class=keyword>const</span> postcssLoader = &#123;</span><br><span class=line>    loader: <span class=string>'postcss-loader'</span>,</span><br><span class=line>    options: &#123;</span><br><span class=line>      <span class=comment>// 是否使用sourceMap,postcss-loader用来解决各浏览器的前缀问题</span></span><br><span class=line>      <span class=comment>// 传送门:https://webpack.js.org/loaders/postcss-loader/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line>      sourceMap: options.sourceMap</span><br><span class=line>    &#125;</span><br><span class=line>  &#125;</span><br><span class=line></span><br><span class=line>  <span class=comment>// 生成loader字符串以用于提取文本插件</span></span><br><span class=line>  <span class=function><span class=keyword>function</span> <span class=title>generateLoaders</span> (<span class=params>loader, loaderOptions</span>) </span>&#123;</span><br><span class=line>    <span class=keyword>const</span> loaders = options.usePostCSS ? [cssLoader, postcssLoader] : [cssLoader]</span><br><span class=line>    <span class=comment>// 判断将cssLoader和postcssLoader推入loaders数组</span></span><br><span class=line>    <span class=keyword>if</span> (loader) &#123;</span><br><span class=line>      loaders.push(&#123;</span><br><span class=line>        loader: loader + <span class=string>'-loader'</span>,</span><br><span class=line>        options: <span class=built_in>Object</span>.assign(&#123;&#125;, loaderOptions, &#123;</span><br><span class=line>          sourceMap: options.sourceMap</span><br><span class=line>        &#125;)</span><br><span class=line>      &#125;)</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    <span class=comment>// 在指定该选项时提取CSS（生产构建期间就是这种情况）</span></span><br><span class=line>    <span class=keyword>if</span> (options.extract) &#123;</span><br><span class=line>      <span class=comment>// 如果options.extract存在,则用extract-text-plugin提取样式</span></span><br><span class=line>      <span class=keyword>return</span> ExtractTextPlugin.extract(&#123;</span><br><span class=line>        use: loaders,</span><br><span class=line>        fallback: <span class=string>'vue-style-loader'</span></span><br><span class=line>      &#125;)</span><br><span class=line>    &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>      <span class=comment>// 无需提取样式则简单使用vue-style-loader配合各种样式loader去处理vue当中的&lt;style&gt;里面的样式</span></span><br><span class=line>      <span class=comment>// 传送门:https://vue-loader.vuejs.org/en/configurations/extract-css.html</span></span><br><span class=line>      <span class=keyword>return</span> [<span class=string>'vue-style-loader'</span>].concat(loaders)</span><br><span class=line>    &#125;</span><br><span class=line>  &#125;</span><br><span class=line></span><br><span class=line>  <span class=comment>// https://vue-loader.vuejs.org/zh/guide/extract-css.html</span></span><br><span class=line>  <span class=comment>// cssLoaders将各种loader 转成对象形式以便styleLoaders进行处理</span></span><br><span class=line>  <span class=keyword>return</span> &#123;</span><br><span class=line>    css: generateLoaders(),</span><br><span class=line>    postcss: generateLoaders(),</span><br><span class=line>    less: generateLoaders(<span class=string>'less'</span>),</span><br><span class=line>    sass: generateLoaders(<span class=string>'sass'</span>, &#123; <span class=attr>indentedSyntax</span>: <span class=literal>true</span> &#125;),</span><br><span class=line>    scss: generateLoaders(<span class=string>'sass'</span>),</span><br><span class=line>    stylus: generateLoaders(<span class=string>'stylus'</span>),</span><br><span class=line>    styl: generateLoaders(<span class=string>'stylus'</span>)</span><br><span class=line>  &#125;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=comment>// 为独立样式文件生成 loader（.vue文件之外）</span></span><br><span class=line><span class=comment>//  styleLoaders进行再加工处理，生成处理单独的.css、.sass、.scss等样式文件的规则</span></span><br><span class=line>exports.styleLoaders = <span class=function><span class=keyword>function</span> (<span class=params>options</span>) </span>&#123;</span><br><span class=line>  <span class=keyword>const</span> output = []</span><br><span class=line>  <span class=comment>// 调用cssLoaders方法 </span></span><br><span class=line>  <span class=comment>// 这时的usePostCSS存在</span></span><br><span class=line>  <span class=keyword>const</span> loaders = exports.cssLoaders(options)</span><br><span class=line>  <span class=keyword>for</span> (<span class=keyword>const</span> extension <span class=keyword>in</span> loaders) &#123;</span><br><span class=line>    <span class=keyword>const</span> loader = loaders[extension]</span><br><span class=line>    output.push(&#123;</span><br><span class=line>      test: <span class=keyword>new</span> <span class=built_in>RegExp</span>(<span class=string>'\\.'</span> + extension + <span class=string>'$'</span>),</span><br><span class=line>      use: loader</span><br><span class=line>    &#125;)</span><br><span class=line>  &#125;</span><br><span class=line>  <span class=keyword>return</span> output</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line>exports.createNotifierCallback = <span class=function><span class=params>()</span> =&gt;</span> &#123;</span><br><span class=line>  <span class=comment>// 引入node-notifier模块，这个模块是用来在桌面窗口提示信息，如果想要关闭直接return掉或者在webpack.dev.conf.js中关掉</span></span><br><span class=line>  <span class=comment>// 传送门:https://www.npmjs.com/package/node-notifier</span></span><br><span class=line>  <span class=keyword>const</span> notifier = <span class=built_in>require</span>(<span class=string>'node-notifier'</span>)</span><br><span class=line></span><br><span class=line>  <span class=keyword>return</span> <span class=function>(<span class=params>severity, errors</span>) =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>if</span> (severity !== <span class=string>'error'</span>) <span class=keyword>return</span></span><br><span class=line>    <span class=comment>// 每次捕获第一个错误</span></span><br><span class=line>    <span class=keyword>const</span> error = errors[<span class=number>0</span>]</span><br><span class=line>    <span class=comment>// 错误文件的名称</span></span><br><span class=line>    <span class=keyword>const</span> filename = error.file &amp;&amp; error.file.split(<span class=string>'!'</span>).pop()</span><br><span class=line>    <span class=comment>//当报错时输出错误信息的标题，错误信息详情，副标题以及图标</span></span><br><span class=line>    notifier.notify(&#123;</span><br><span class=line>      title: packageConfig.name,</span><br><span class=line>      message: severity + <span class=string>': '</span> + error.name,</span><br><span class=line>      subtitle: filename || <span class=string>''</span>,</span><br><span class=line>      icon: path.join(__dirname, <span class=string>'logo.png'</span>)</span><br><span class=line>    &#125;)</span><br><span class=line>  &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h4 id=vue-loader-conf-js><a href=#vue-loader-conf-js class=headerlink title=vue-loader.conf.js></a>vue-loader.conf.js</h4><p>该文件的主要作用就是处理.vue文件，解析这个文件中的每个语言块（template、script、style)，转换成js可用的js模块。主要完成如下工作：</p><ol><li>配置vue-loader，将一些遇见的文件转换成可供webpack进行模块化处理</li></ol><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br></pre></td><td class=code><pre><span class=line><span class=meta>'use strict'</span></span><br><span class=line><span class=keyword>const</span> utils = <span class=built_in>require</span>(<span class=string>'./utils'</span>)</span><br><span class=line><span class=keyword>const</span> config = <span class=built_in>require</span>(<span class=string>'../config'</span>)</span><br><span class=line><span class=keyword>const</span> isProduction = process.env.NODE_ENV === <span class=string>'production'</span></span><br><span class=line><span class=keyword>const</span> sourceMapEnabled = isProduction</span><br><span class=line>  ? config.build.productionSourceMap</span><br><span class=line>  : config.dev.cssSourceMap</span><br><span class=line><span class=comment>//处理项目中的css文件，生产环境和测试环境默认是打开sourceMap，而extract中的提取样式到单独文件只有在生产环境中才需要</span></span><br><span class=line><span class=built_in>module</span>.exports = &#123;</span><br><span class=line>  loaders: utils.cssLoaders(&#123;</span><br><span class=line>    sourceMap: sourceMapEnabled,</span><br><span class=line>    <span class=comment>// 是否将样式提取到单独的文件</span></span><br><span class=line>    extract: isProduction</span><br><span class=line>  &#125;),</span><br><span class=line>  <span class=comment>// 是否开启cssSourceMap, 关闭可以避免 css-loader 的 some relative path related bugs 同时可以加快构建速度</span></span><br><span class=line>  <span class=comment>// 传送门:https://vue-loader-v14.vuejs.org/zh-cn/options.html#csssourcemap</span></span><br><span class=line>  cssSourceMap: sourceMapEnabled,</span><br><span class=line>  <span class=comment>// 是否通过将哈希查询附加到文件名来生成具有缓存清除的源映射</span></span><br><span class=line>  cacheBusting: config.dev.cacheBusting,</span><br><span class=line>  <span class=comment>// 在模版编译过程中，编译器可以将某些属性，如 src 路径，转换为require调用，以便目标资源可以由 webpack 处理</span></span><br><span class=line>  <span class=comment>// 传送门:https://vue-loader.vuejs.org/zh-cn/options.html#transformtorequire</span></span><br><span class=line>  transformToRequire: &#123;</span><br><span class=line>    video: [<span class=string>'src'</span>, <span class=string>'poster'</span>],</span><br><span class=line>    source: <span class=string>'src'</span>,</span><br><span class=line>    img: <span class=string>'src'</span>,</span><br><span class=line>    image: <span class=string>'xlink:href'</span></span><br><span class=line>  &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h4 id=webpack-base-conf-js><a href=#webpack-base-conf-js class=headerlink title=webpack.base.conf.js></a>webpack.base.conf.js</h4><p>webpack.base.conf.js主要完成如下工作：</p><ol><li>配置webpack编译入口</li><li>配置webpack输出路径和命名规则</li><li>配置模块resolve规则</li><li>配置不同类型模块的处理规则</li></ol><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br></pre></td><td class=code><pre><span class=line><span class=meta>'use strict'</span></span><br><span class=line><span class=comment>// node.js的文件路径，用来处理文件当中的路径问题</span></span><br><span class=line><span class=comment>// 传送门:http://www.jianshu.com/p/fe41ee02efc8</span></span><br><span class=line><span class=keyword>const</span> path = <span class=built_in>require</span>(<span class=string>'path'</span>)</span><br><span class=line><span class=keyword>const</span> utils = <span class=built_in>require</span>(<span class=string>'./utils'</span>)</span><br><span class=line><span class=comment>// 默认是index文件，引入index.js模块</span></span><br><span class=line><span class=keyword>const</span> config = <span class=built_in>require</span>(<span class=string>'../config'</span>)</span><br><span class=line><span class=comment>// vue-loader.conf配置文件是用来解决各种css文件的，定义了诸如css、less、sass之类的和样式有关的loader</span></span><br><span class=line><span class=keyword>const</span> vueLoaderConfig = <span class=built_in>require</span>(<span class=string>'./vue-loader.conf'</span>)</span><br><span class=line></span><br><span class=line><span class=comment>// 此函数是用来返回当前目录的平行目录的路径，因为有个'..'</span></span><br><span class=line><span class=function><span class=keyword>function</span> <span class=title>resolve</span> (<span class=params>dir</span>) </span>&#123;</span><br><span class=line>  <span class=keyword>return</span> path.join(__dirname, <span class=string>'..'</span>, dir)</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=keyword>const</span> createLintingRule = <span class=function><span class=params>()</span> =&gt;</span> (&#123;</span><br><span class=line>  test: <span class=regexp>/\.(js|vue)$/</span>,</span><br><span class=line>  loader: <span class=string>'eslint-loader'</span>,</span><br><span class=line>  enforce: <span class=string>'pre'</span>,</span><br><span class=line>  include: [resolve(<span class=string>'src'</span>), resolve(<span class=string>'test'</span>)],</span><br><span class=line>  options: &#123;</span><br><span class=line>    formatter: <span class=built_in>require</span>(<span class=string>'eslint-friendly-formatter'</span>),</span><br><span class=line>    emitWarning: !config.dev.showEslintErrorsInOverlay</span><br><span class=line>  &#125;</span><br><span class=line>&#125;)</span><br><span class=line></span><br><span class=line><span class=built_in>module</span>.exports = &#123;</span><br><span class=line>  <span class=comment>//基础目录（绝对路径），用于从配置中解析入口点和加载程序</span></span><br><span class=line>  <span class=comment>// 传送门:https://webpack.js.org/configuration/entry-context/#context</span></span><br><span class=line>  context: path.resolve(__dirname, <span class=string>'../'</span>),</span><br><span class=line>  entry: &#123;</span><br><span class=line>    <span class=comment>// 定义入口文件</span></span><br><span class=line>    app: <span class=string>'./src/main.js'</span></span><br><span class=line>  &#125;,</span><br><span class=line>  output: &#123;</span><br><span class=line>    <span class=comment>// 打包生成的出口文件所放的位置</span></span><br><span class=line>    path: config.build.assetsRoot,</span><br><span class=line>    <span class=comment>// 打包生成app.js文件</span></span><br><span class=line>    filename: <span class=string>'[name].js'</span>,</span><br><span class=line>    <span class=comment>// 项目上线地址，也就是真正的文件引用路径，如果是production环境，其实这里都是'/'</span></span><br><span class=line>    publicPath: process.env.NODE_ENV === <span class=string>'production'</span></span><br><span class=line>      ? config.build.assetsPublicPath</span><br><span class=line>      : config.dev.assetsPublicPath</span><br><span class=line>  &#125;,</span><br><span class=line>  resolve: &#123;</span><br><span class=line>    <span class=comment>// 省略扩展名，比方说import index from '../js/index'会默认去找index文件，然后找index.js,index.vue,index.json文件</span></span><br><span class=line>    extensions: [<span class=string>'.js'</span>, <span class=string>'.vue'</span>, <span class=string>'.json'</span>],</span><br><span class=line>    <span class=comment>//创建路径的别名，比如增加'components': resolve('src/components')等</span></span><br><span class=line>    alias: &#123;</span><br><span class=line>      <span class=string>'@'</span>: resolve(<span class=string>'src'</span>),</span><br><span class=line>    &#125;</span><br><span class=line>  &#125;,</span><br><span class=line>  <span class=comment>//使用插件配置相应文件的处理方法</span></span><br><span class=line>  <span class=built_in>module</span>: &#123;</span><br><span class=line>    rules: [</span><br><span class=line>      ...(config.dev.useEslint ? [createLintingRule()] : []),</span><br><span class=line>      <span class=comment>//使用vue-loader将vue文件转化成js的模块</span></span><br><span class=line>      &#123;</span><br><span class=line>        test: <span class=regexp>/\.vue$/</span>,</span><br><span class=line>        loader: <span class=string>'vue-loader'</span>,</span><br><span class=line>        options: vueLoaderConfig</span><br><span class=line>      &#125;,</span><br><span class=line>      <span class=comment>// js文件需要通过babel-loader进行编译成es5文件以及压缩等操作</span></span><br><span class=line>      &#123;</span><br><span class=line>        test: <span class=regexp>/\.js$/</span>,</span><br><span class=line>        loader: <span class=string>'babel-loader'</span>,</span><br><span class=line>        include: [resolve(<span class=string>'src'</span>), resolve(<span class=string>'test'</span>), resolve(<span class=string>'node_modules/webpack-dev-server/client'</span>)]</span><br><span class=line>      &#125;,</span><br><span class=line>      <span class=comment>//图片、音像、字体都使用url-loader进行处理，文件小于10000 byte 会编译成base64</span></span><br><span class=line>      &#123;</span><br><span class=line>        test: <span class=regexp>/\.(png|jpe?g|gif|svg)(\?.*)?$/</span>,</span><br><span class=line>        loader: <span class=string>'url-loader'</span>,</span><br><span class=line>        options: &#123;</span><br><span class=line>          limit: <span class=number>10000</span>,</span><br><span class=line>          name: utils.assetsPath(<span class=string>'img/[name].[hash:7].[ext]'</span>)</span><br><span class=line>        &#125;</span><br><span class=line>      &#125;,</span><br><span class=line>      &#123;</span><br><span class=line>        test: <span class=regexp>/\.(mp4|webm|ogg|mp3|wav|flac|aac)(\?.*)?$/</span>,</span><br><span class=line>        loader: <span class=string>'url-loader'</span>,</span><br><span class=line>        options: &#123;</span><br><span class=line>          limit: <span class=number>10000</span>,</span><br><span class=line>          name: utils.assetsPath(<span class=string>'media/[name].[hash:7].[ext]'</span>)</span><br><span class=line>        &#125;</span><br><span class=line>      &#125;,</span><br><span class=line>      &#123;</span><br><span class=line>        test: <span class=regexp>/\.(woff2?|eot|ttf|otf)(\?.*)?$/</span>,</span><br><span class=line>        loader: <span class=string>'url-loader'</span>,</span><br><span class=line>        options: &#123;</span><br><span class=line>          limit: <span class=number>10000</span>,</span><br><span class=line>          name: utils.assetsPath(<span class=string>'fonts/[name].[hash:7].[ext]'</span>)</span><br><span class=line>        &#125;</span><br><span class=line>      &#125;</span><br><span class=line>    ]</span><br><span class=line>  &#125;,</span><br><span class=line></span><br><span class=line>  <span class=comment>//这些选项可以配置是否 polyfill 或 mock 某些 Node.js 全局变量和模块。这可以使最初为 Node.js 环境编写的代码，在其他环境（如浏览器）中运行</span></span><br><span class=line>  <span class=comment>//传送门:http://www.css88.com/doc/webpack/configuration/node/</span></span><br><span class=line>  node: &#123;</span><br><span class=line>    <span class=comment>// 防止webpack注入无用的setImmediate polyfill，因为Vue源代码包含它（尽管只在本地使用时才会使用它）</span></span><br><span class=line>    setImmediate: <span class=literal>false</span>,</span><br><span class=line>    <span class=comment>// 防止webpack将模拟注入到对客户端无意义的Node本地模块中</span></span><br><span class=line>    dgram: <span class=string>'empty'</span>,</span><br><span class=line>    fs: <span class=string>'empty'</span>,</span><br><span class=line>    net: <span class=string>'empty'</span>,</span><br><span class=line>    tls: <span class=string>'empty'</span>,</span><br><span class=line>    child_process: <span class=string>'empty'</span></span><br><span class=line>  &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p><span class=exturl data-url="aHR0cHM6Ly92dWUtbG9hZGVyLnZ1ZWpzLm9yZy8=" title=https://vue-loader.vuejs.org/ >vue-loader<i class="fa fa-external-link"></i></span>文档传送门<br><span class=exturl data-url=aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvYmFiZWwtbG9hZGVy title=https://www.npmjs.com/package/babel-loader>babel-loader<i class="fa fa-external-link"></i></span>文档传送门</p><h4 id=webpack-dev-conf-js><a href=#webpack-dev-conf-js class=headerlink title=webpack.dev.conf.js></a>webpack.dev.conf.js</h4><p>当执行 <code>npm run dev</code> 时，我们执行的就是该js文件，该文件主要完成以下任务：</p><ol><li>引入相关插件和配置</li><li>生成处理各种样式的规则</li><li>配置开发环境，如热更新、监听端口号，是否自动打开浏览器等都在webpack中的devServer中配置完成</li><li>寻找可利用的端口和添加显示程序编译运行时的错误信息</li></ol><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br></pre></td><td class=code><pre><span class=line><span class=meta>'use strict'</span></span><br><span class=line><span class=comment>// utils提供工具函数，包括生成处理各种样式语言的loader，获取资源文件存放路径的工具函数</span></span><br><span class=line><span class=keyword>const</span> utils = <span class=built_in>require</span>(<span class=string>'./utils'</span>)</span><br><span class=line><span class=keyword>const</span> webpack = <span class=built_in>require</span>(<span class=string>'webpack'</span>)</span><br><span class=line><span class=comment>// 默认是index文件</span></span><br><span class=line><span class=keyword>const</span> config = <span class=built_in>require</span>(<span class=string>'../config'</span>)</span><br><span class=line><span class=comment>// 将基础配置和开发环境配置或者生产环境配置合并在一起的包管理</span></span><br><span class=line><span class=keyword>const</span> merge = <span class=built_in>require</span>(<span class=string>'webpack-merge'</span>)</span><br><span class=line><span class=keyword>const</span> path = <span class=built_in>require</span>(<span class=string>'path'</span>)</span><br><span class=line><span class=keyword>const</span> baseWebpackConfig = <span class=built_in>require</span>(<span class=string>'./webpack.base.conf'</span>)</span><br><span class=line><span class=keyword>const</span> CopyWebpackPlugin = <span class=built_in>require</span>(<span class=string>'copy-webpack-plugin'</span>)</span><br><span class=line><span class=comment>// 对相应的文件名进行及时更改，并自动打包注入到index.html里面</span></span><br><span class=line><span class=comment>// 传送门：https://webpack.js.org/plugins/html-webpack-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line><span class=keyword>const</span> HtmlWebpackPlugin = <span class=built_in>require</span>(<span class=string>'html-webpack-plugin'</span>)</span><br><span class=line><span class=comment>// 识别某些类型的webpack错误并清理，汇总和优化它们以提供更好的开发者体验</span></span><br><span class=line><span class=comment>// 传送门:https://www.npmjs.com/package/friendly-errors-webpack-plugin</span></span><br><span class=line><span class=keyword>const</span> FriendlyErrorsPlugin = <span class=built_in>require</span>(<span class=string>'friendly-errors-webpack-plugin'</span>)</span><br><span class=line><span class=comment>// 查看空闲端口位置，默认情况下搜索8000这个端口</span></span><br><span class=line><span class=comment>// 传送门:https://www.npmjs.com/package/portfinder</span></span><br><span class=line><span class=keyword>const</span> portfinder = <span class=built_in>require</span>(<span class=string>'portfinder'</span>)</span><br><span class=line></span><br><span class=line><span class=comment>// processs为node的一个全局对象获取当前程序的环境变量，即host</span></span><br><span class=line><span class=comment>// 传送门:http://javascript.ruanyifeng.com/nodejs/process.html#toc5</span></span><br><span class=line><span class=keyword>const</span> HOST = process.env.HOST</span><br><span class=line><span class=keyword>const</span> PORT = process.env.PORT &amp;&amp; <span class=built_in>Number</span>(process.env.PORT)</span><br><span class=line></span><br><span class=line><span class=keyword>const</span> devWebpackConfig = merge(baseWebpackConfig, &#123;</span><br><span class=line>  <span class=built_in>module</span>: &#123;</span><br><span class=line>    <span class=comment>//自动生成了css、postcss、less等规则，并进行模块转换，转换成webpack可识别的文件</span></span><br><span class=line>    rules: utils.styleLoaders(&#123; <span class=attr>sourceMap</span>: config.dev.cssSourceMap, <span class=attr>usePostCSS</span>: <span class=literal>true</span> &#125;)</span><br><span class=line>  &#125;,</span><br><span class=line>  <span class=comment>// cheap-module-eval-source-map is faster for development</span></span><br><span class=line>  <span class=comment>// 增加调试信息</span></span><br><span class=line>  <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/devtool</span></span><br><span class=line>  devtool: config.dev.devtool,</span><br><span class=line></span><br><span class=line>  <span class=comment>// 以下设置可在/config/index.js中配置</span></span><br><span class=line>  devServer: &#123;</span><br><span class=line>    <span class=comment>// 在开发工具(DevTools)的控制台将显示消息【如：在重新加载之前，在一个错误之前，或者模块热替换(HMR)启动时，这可能显示得很繁琐】</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-clientloglevel</span></span><br><span class=line>    clientLogLevel: <span class=string>'warning'</span>,</span><br><span class=line>    <span class=comment>// 当使用 HTML5 History API 时，任意的 404 响应都可能需要被替代为 index.html</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-historyapifallback</span></span><br><span class=line>    historyApiFallback: &#123;</span><br><span class=line>      rewrites: [</span><br><span class=line>        &#123; <span class=attr>from</span>: <span class=regexp>/.*/</span>, <span class=attr>to</span>: path.posix.join(config.dev.assetsPublicPath, <span class=string>'index.html'</span>) &#125;,</span><br><span class=line>      ],</span><br><span class=line>    &#125;,</span><br><span class=line>    <span class=comment>// 启动模块热更新特性</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-hot</span></span><br><span class=line>    hot: <span class=literal>true</span>,</span><br><span class=line>    contentBase: <span class=literal>false</span>, <span class=comment>// since we use CopyWebpackPlugin.</span></span><br><span class=line>    <span class=comment>// 一切服务都启动用gzip方式进行压缩代码</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-compress</span></span><br><span class=line>    compress: <span class=literal>true</span>,</span><br><span class=line>    <span class=comment>// 指定使用一个host,默认是localhost,获取HOST地址，该文件定义或config中index里的dev配置里获取</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-host</span></span><br><span class=line>    host: HOST || config.dev.host,</span><br><span class=line>    <span class=comment>// 指定要监听的端口号</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-port</span></span><br><span class=line>    port: PORT || config.dev.port,</span><br><span class=line>    <span class=comment>// 指定服务器是否自动打开默认浏览器</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-open</span></span><br><span class=line>    open: config.dev.autoOpenBrowser,</span><br><span class=line>    <span class=comment>// 当出现编译器错误或警告时，在浏览器中显示全屏叠加,覆盖到浏览器的项目页面的上方。&#123;warning:false,errors:true&#125;这个选项为 显示错误和警告</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-overlay</span></span><br><span class=line>    overlay: config.dev.errorOverlay</span><br><span class=line>      ? &#123; <span class=attr>warnings</span>: <span class=literal>false</span>, <span class=attr>errors</span>: <span class=literal>true</span> &#125;</span><br><span class=line>      : <span class=literal>false</span>,</span><br><span class=line>    <span class=comment>// 服务器假设运行在http://localhost:8080并且output.filename被设置为bundle.js默认。publicPath是"/"，所以你的包可以通过http://localhost:8080/bundle.js访问</span></span><br><span class=line>    <span class=comment>// 比如将config中的index.js dev对象的中的assertsPublicPath设置为"/asserts/"那么文件打开后将通过http://localhost:8080/asserts/来进行访问</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-publicpath-</span></span><br><span class=line>    publicPath: config.dev.assetsPublicPath,</span><br><span class=line>    <span class=comment>// 如果你有单独的后端开发服务器API，并且希望在同域名下发送API请求，那么代理某些URL将很有用，简称就是API代理,中间件。需引入 http-proxy-middleware</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-proxy</span></span><br><span class=line>    proxy: config.dev.proxyTable,</span><br><span class=line>    <span class=comment>// 启用quiet后，除了初始启动信息之外的任何内容都不会被打印到控制台。这也意味着来自WebPack的错误或警告在控制台不可见</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-quiet-</span></span><br><span class=line>    quiet: <span class=literal>true</span>, <span class=comment>// necessary for FriendlyErrorsPlugin</span></span><br><span class=line>    <span class=comment>// webpack使用文件系统（file system）获取文件改动的通知</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/configuration/dev-server/#devserver-watchoptions-</span></span><br><span class=line>    watchOptions: &#123;</span><br><span class=line>      poll: config.dev.poll,</span><br><span class=line>    &#125;</span><br><span class=line>  &#125;,</span><br><span class=line>  plugins: [</span><br><span class=line>    <span class=comment>// DefinePlugin允许您创建可在编译时配置的全局常量。 这对于允许开发构建和发布构建之间的不同行为很有用。</span></span><br><span class=line>    <span class=comment>// 传送门:https://webpack.js.org/plugins/define-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line>    <span class=keyword>new</span> webpack.DefinePlugin(&#123;</span><br><span class=line>      <span class=string>'process.env'</span>: <span class=built_in>require</span>(<span class=string>'../config/dev.env'</span>)</span><br><span class=line>    &#125;),</span><br><span class=line>    <span class=comment>// 模块热替换(Hot Module Replacement 或 HMR)是 webpack 提供的最有用的功能之一。它允许在运行时更新各种模块，而无需进行完全刷新</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/guides/hot-module-replacement/</span></span><br><span class=line>    <span class=keyword>new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class=line>    <span class=comment>// 当进行热更新时，相关文件名会被展示出来</span></span><br><span class=line>    <span class=comment>// 传送门:https://webpack.js.org/plugins/named-modules-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line>    <span class=keyword>new</span> webpack.NamedModulesPlugin(), <span class=comment>// HMR shows correct file names in console on update.</span></span><br><span class=line>    <span class=comment>// 跳过编译时出错的代码并记录，使编译后运行时的包不会发生错误</span></span><br><span class=line>    <span class=comment>// 传送门:https://webpack.js.org/plugins/no-emit-on-errors-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line>    <span class=keyword>new</span> webpack.NoEmitOnErrorsPlugin(),</span><br><span class=line>    <span class=comment>// 该插件可自动生成一个 html5 文件或使用模板文件将编译好的代码注入进去</span></span><br><span class=line>    <span class=comment>// 传送门:https://webpack.js.org/plugins/html-webpack-plugin/#src/components/Sidebar/Sidebar.jsx  </span></span><br><span class=line>    <span class=comment>// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=line>    <span class=keyword>new</span> HtmlWebpackPlugin(&#123;</span><br><span class=line>      filename: <span class=string>'index.html'</span>,</span><br><span class=line>      template: <span class=string>'index.html'</span>,</span><br><span class=line>      inject: <span class=literal>true</span></span><br><span class=line>    &#125;),</span><br><span class=line>    <span class=comment>// copy custom static assets</span></span><br><span class=line>    <span class=keyword>new</span> CopyWebpackPlugin([</span><br><span class=line>      &#123;</span><br><span class=line>        <span class=keyword>from</span>: path.resolve(__dirname, <span class=string>'../static'</span>),</span><br><span class=line>        to: config.dev.assetsSubDirectory,</span><br><span class=line>        ignore: [<span class=string>'.*'</span>]</span><br><span class=line>      &#125;</span><br><span class=line>    ])</span><br><span class=line>  ]</span><br><span class=line>&#125;)</span><br><span class=line></span><br><span class=line><span class=built_in>module</span>.exports = <span class=keyword>new</span> <span class=built_in>Promise</span>(<span class=function>(<span class=params>resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=line>  <span class=comment>//由于portfinder这个插件本身是从8000开始查找，这里设置查找的默认端口号</span></span><br><span class=line>  portfinder.basePort = process.env.PORT || config.dev.port</span><br><span class=line>  portfinder.getPort(<span class=function>(<span class=params>err, port</span>) =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>if</span> (err) &#123;</span><br><span class=line>      reject(err)</span><br><span class=line>    &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>      <span class=comment>// publish the new Port, necessary for e2e tests</span></span><br><span class=line>      <span class=comment>// 如果端口被占用就对进程设置端口</span></span><br><span class=line>      process.env.PORT = port</span><br><span class=line>      <span class=comment>// 如果端口被占用就设置devServer的端口</span></span><br><span class=line>      <span class=comment>// add port to devServer config</span></span><br><span class=line>      devWebpackConfig.devServer.port = port</span><br><span class=line></span><br><span class=line>      <span class=comment>// Add FriendlyErrorsPlugin</span></span><br><span class=line>      devWebpackConfig.plugins.push(<span class=keyword>new</span> FriendlyErrorsPlugin(&#123;</span><br><span class=line>        <span class=comment>// 添加提示信息，所在域名和端口的提示信息</span></span><br><span class=line>        compilationSuccessInfo: &#123;</span><br><span class=line>          messages: [<span class=string>`Your application is running here: http://<span class=subst>$&#123;devWebpackConfig.devServer.host&#125;</span>:<span class=subst>$&#123;port&#125;</span>`</span>],</span><br><span class=line>        &#125;,</span><br><span class=line>        <span class=comment>// 窗口提示信息,调用utils工具函数的createNotifierCallBack()方法</span></span><br><span class=line>        onErrors: config.dev.notifyOnErrors</span><br><span class=line>        ? utils.createNotifierCallback()</span><br><span class=line>        : <span class=literal>undefined</span></span><br><span class=line>      &#125;))</span><br><span class=line>      <span class=comment>// 如果找到能用的端口号，就把配置信息提示抛出去</span></span><br><span class=line>      resolve(devWebpackConfig)</span><br><span class=line>    &#125;</span><br><span class=line>  &#125;)</span><br><span class=line>&#125;)</span><br></pre></td></tr></table></figure><h4 id=webpack-prod-conf-js><a href=#webpack-prod-conf-js class=headerlink title=webpack.prod.conf.js></a>webpack.prod.conf.js</h4><p>构建的时候用到的webpack配置来自webpack.prod.conf.js，该配置同样是在webpack.base.conf基础上的进一步完善。主要完成如下工作：</p><ol><li>合并基础的webpack配置</li><li>配置样式文件的处理规则，styleLoaders</li><li>配置webpack的输出</li><li>配置webpack插件</li><li>gzip模式下的webpack插件配置</li><li>webpack-bundle分析</li></ol><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br></pre></td><td class=code><pre><span class=line><span class=meta>'use strict'</span></span><br><span class=line><span class=keyword>const</span> path = <span class=built_in>require</span>(<span class=string>'path'</span>)</span><br><span class=line><span class=keyword>const</span> utils = <span class=built_in>require</span>(<span class=string>'./utils'</span>)</span><br><span class=line><span class=keyword>const</span> webpack = <span class=built_in>require</span>(<span class=string>'webpack'</span>)</span><br><span class=line><span class=keyword>const</span> config = <span class=built_in>require</span>(<span class=string>'../config'</span>)</span><br><span class=line><span class=comment>// 将基础配置和开发环境配置或者生产环境配置合并在一起的包管理</span></span><br><span class=line><span class=keyword>const</span> merge = <span class=built_in>require</span>(<span class=string>'webpack-merge'</span>)</span><br><span class=line><span class=comment>// 引入webpack的基础配置</span></span><br><span class=line><span class=keyword>const</span> baseWebpackConfig = <span class=built_in>require</span>(<span class=string>'./webpack.base.conf'</span>)</span><br><span class=line><span class=comment>// 在webpack中拷贝文件和文件夹</span></span><br><span class=line><span class=comment>// 传送门:https://doc.webpack-china.org/plugins/copy-webpack-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line><span class=keyword>const</span> CopyWebpackPlugin = <span class=built_in>require</span>(<span class=string>'copy-webpack-plugin'</span>)</span><br><span class=line><span class=comment>// 文件名即使更改，自动打包并且生成相应的文件在index.html里面</span></span><br><span class=line><span class=comment>// 传送门:https://webpack.js.org/plugins/html-webpack-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line><span class=keyword>const</span> HtmlWebpackPlugin = <span class=built_in>require</span>(<span class=string>'html-webpack-plugin'</span>)</span><br><span class=line><span class=comment>// 它会将所有的入口 chunk(entry chunks) 中引用的 *.css，移动到独立分离的 CSS 文件</span></span><br><span class=line><span class=comment>// https://doc.webpack-china.org/plugins/extract-text-webpack-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line><span class=keyword>const</span> ExtractTextPlugin = <span class=built_in>require</span>(<span class=string>'extract-text-webpack-plugin'</span>)</span><br><span class=line><span class=comment>//一个用来压缩优化CSS文件的东西</span></span><br><span class=line><span class=comment>// 传送门:http://npm.taobao.org/package/optimize-css-assets-webpack-plugin</span></span><br><span class=line><span class=keyword>const</span> OptimizeCSSPlugin = <span class=built_in>require</span>(<span class=string>'optimize-css-assets-webpack-plugin'</span>)</span><br><span class=line><span class=comment>// 一个用来压缩优化JS文件的东西</span></span><br><span class=line><span class=comment>// 传送门:https://webpack.js.org/plugins/uglifyjs-webpack-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line><span class=keyword>const</span> UglifyJsPlugin = <span class=built_in>require</span>(<span class=string>'uglifyjs-webpack-plugin'</span>)</span><br><span class=line><span class=comment>// 引入生产环境</span></span><br><span class=line><span class=keyword>const</span> env = <span class=built_in>require</span>(<span class=string>'../config/prod.env'</span>)</span><br><span class=line></span><br><span class=line><span class=keyword>const</span> webpackConfig = merge(baseWebpackConfig, &#123;</span><br><span class=line>  <span class=comment>// 将webpack基本配置和生产环境配置合并在一起，生成css,postcss,less等规则，并进行模块转换，转换成webpack可识别的文件，进行解析</span></span><br><span class=line>  <span class=comment>// 将CSS提取到单独文件中去</span></span><br><span class=line>  <span class=built_in>module</span>: &#123;</span><br><span class=line>    rules: utils.styleLoaders(&#123;</span><br><span class=line>      sourceMap: config.build.productionSourceMap,</span><br><span class=line>      extract: <span class=literal>true</span>,</span><br><span class=line>      usePostCSS: <span class=literal>true</span></span><br><span class=line>    &#125;)</span><br><span class=line>  &#125;,</span><br><span class=line>  devtool: config.build.productionSourceMap ? config.build.devtool : <span class=literal>false</span>,</span><br><span class=line>  output: &#123;</span><br><span class=line>    <span class=comment>// 文件打包的输出路径</span></span><br><span class=line>    path: config.build.assetsRoot,</span><br><span class=line>    <span class=comment>// 主文件入口文件名字</span></span><br><span class=line>    filename: utils.assetsPath(<span class=string>'js/[name].[chunkhash].js'</span>),</span><br><span class=line>    <span class=comment>// 非主文件入口文件名</span></span><br><span class=line>    <span class=comment>// 传送门:http://react-china.org/t/webpack-output-filename-output-chunkfilename/2256</span></span><br><span class=line>    chunkFilename: utils.assetsPath(<span class=string>'js/[id].[chunkhash].js'</span>)</span><br><span class=line>  &#125;,</span><br><span class=line>  plugins: [</span><br><span class=line>    <span class=comment>// http://vuejs.github.io/vue-loader/en/workflow/production.html</span></span><br><span class=line>    <span class=comment>// DefinePlugin 允许创建一个在编译时可以配置的全局常量。这可能会对开发模式和发布模式的构建允许不同的行为非常有用。</span></span><br><span class=line>    <span class=comment>// https://doc.webpack-china.org/plugins/define-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line>    <span class=keyword>new</span> webpack.DefinePlugin(&#123;</span><br><span class=line>      <span class=string>'process.env'</span>: env</span><br><span class=line>    &#125;),</span><br><span class=line>    <span class=keyword>new</span> UglifyJsPlugin(&#123;</span><br><span class=line>      uglifyOptions: &#123;</span><br><span class=line>        compress: &#123;</span><br><span class=line>          warnings: <span class=literal>false</span></span><br><span class=line>        &#125;</span><br><span class=line>      &#125;,</span><br><span class=line>      sourceMap: config.build.productionSourceMap,</span><br><span class=line>      parallel: <span class=literal>true</span></span><br><span class=line>    &#125;),</span><br><span class=line>    <span class=comment>// extract css into its own file</span></span><br><span class=line>    <span class=comment>// 它会将所有的入口 chunk(entry chunks)中引用的 *.css，移动到独立分离的 CSS 文件</span></span><br><span class=line>    <span class=comment>// https://doc.webpack-china.org/plugins/extract-text-webpack-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line>    <span class=keyword>new</span> ExtractTextPlugin(&#123;</span><br><span class=line>      filename: utils.assetsPath(<span class=string>'css/[name].[contenthash].css'</span>),</span><br><span class=line>      <span class=comment>// Setting the following option to `false` will not extract CSS from codesplit chunks.</span></span><br><span class=line>      <span class=comment>// Their CSS will instead be inserted dynamically with style-loader when the codesplit chunk has been loaded by webpack.</span></span><br><span class=line>      <span class=comment>// It's currently set to `true` because we are seeing that sourcemaps are included in the codesplit bundle as well when it's `false`, </span></span><br><span class=line>      <span class=comment>// increasing file size: https://github.com/vuejs-templates/webpack/issues/1110</span></span><br><span class=line>      allChunks: <span class=literal>true</span>,</span><br><span class=line>    &#125;),</span><br><span class=line>    <span class=comment>// Compress extracted CSS. We are using this plugin so that possible</span></span><br><span class=line>    <span class=comment>// duplicated CSS from different components can be deduped.</span></span><br><span class=line>    <span class=keyword>new</span> OptimizeCSSPlugin(&#123;</span><br><span class=line>      cssProcessorOptions: config.build.productionSourceMap</span><br><span class=line>        ? &#123; <span class=attr>safe</span>: <span class=literal>true</span>, <span class=attr>map</span>: &#123; <span class=attr>inline</span>: <span class=literal>false</span> &#125; &#125;</span><br><span class=line>        : &#123; <span class=attr>safe</span>: <span class=literal>true</span> &#125;</span><br><span class=line>    &#125;),</span><br><span class=line>    <span class=comment>// generate dist index.html with correct asset hash for caching.</span></span><br><span class=line>    <span class=comment>// you can customize output by editing /index.html</span></span><br><span class=line>    <span class=comment>// see https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=line>    <span class=keyword>new</span> HtmlWebpackPlugin(&#123;</span><br><span class=line>      filename: config.build.index,</span><br><span class=line>      template: <span class=string>'index.html'</span>,</span><br><span class=line>      inject: <span class=literal>true</span>,</span><br><span class=line>      minify: &#123;</span><br><span class=line>        <span class=comment>// 删除index.html中的注释</span></span><br><span class=line>        removeComments: <span class=literal>true</span>,</span><br><span class=line>        <span class=comment>// 删除index.html中的空格</span></span><br><span class=line>        collapseWhitespace: <span class=literal>true</span>,</span><br><span class=line>        <span class=comment>// 删除各种html标签属性值的双引号</span></span><br><span class=line>        removeAttributeQuotes: <span class=literal>true</span></span><br><span class=line>        <span class=comment>// more options:</span></span><br><span class=line>        <span class=comment>// https://github.com/kangax/html-minifier#options-quick-reference</span></span><br><span class=line>      &#125;,</span><br><span class=line>      <span class=comment>// necessary to consistently work with multiple chunks via CommonsChunkPlugin</span></span><br><span class=line>      <span class=comment>// 注入依赖的时候按照依赖先后顺序进行注入，比如，需要先注入vendor.js，再注入app.js</span></span><br><span class=line>      chunksSortMode: <span class=string>'dependency'</span></span><br><span class=line>    &#125;),</span><br><span class=line>    <span class=comment>// keep module.id stable when vendor modules does not change</span></span><br><span class=line>    <span class=comment>// 该插件会根据模块的相对路径生成一个四位数的hash作为模块id, 建议用于生产环境。</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/plugins/hashed-module-ids-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line>    <span class=keyword>new</span> webpack.HashedModuleIdsPlugin(),</span><br><span class=line>    <span class=comment>// enable scope hoisting</span></span><br><span class=line>    <span class=comment>// 预编译所有模块到一个闭包中，提升你的代码在浏览器中的执行速度</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/plugins/module-concatenation-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line>    <span class=keyword>new</span> webpack.optimize.ModuleConcatenationPlugin(),</span><br><span class=line>    <span class=comment>// 将所有从node_modules中引入的js提取到vendor.js，即抽取库文件</span></span><br><span class=line>    <span class=comment>// split vendor js into its own file</span></span><br><span class=line>    <span class=keyword>new</span> webpack.optimize.CommonsChunkPlugin(&#123; <span class=comment>//抽取公共的模块</span></span><br><span class=line>      name: <span class=string>'vendor'</span>,</span><br><span class=line>      minChunks (<span class=built_in>module</span>) &#123;</span><br><span class=line>        <span class=comment>// any required modules inside node_modules are extracted to vendor</span></span><br><span class=line>        <span class=keyword>return</span> (</span><br><span class=line>          <span class=built_in>module</span>.resource &amp;&amp;</span><br><span class=line>          /\.js$/.test(<span class=built_in>module</span>.resource) &amp;&amp;</span><br><span class=line>          <span class=built_in>module</span>.resource.indexOf(</span><br><span class=line>            path.join(__dirname, <span class=string>'../node_modules'</span>)</span><br><span class=line>          ) === <span class=number>0</span></span><br><span class=line>        )</span><br><span class=line>      &#125;</span><br><span class=line>    &#125;),</span><br><span class=line>    <span class=comment>// 把webpack的runtime和manifest这些webpack管理所有模块交互的代码打包到[name].js文件中,防止build之后vendor的hash值被更新</span></span><br><span class=line>    <span class=comment>// 传送门:https://webpack.js.org/plugins/commons-chunk-plugin/#extra-async-commons-chunk</span></span><br><span class=line>    <span class=comment>// extract webpack runtime and module manifest to its own file in order to</span></span><br><span class=line>    <span class=comment>// prevent vendor hash from being updated whenever app bundle is updated</span></span><br><span class=line>    <span class=keyword>new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class=line>      name: <span class=string>'manifest'</span>,</span><br><span class=line>      minChunks: <span class=literal>Infinity</span></span><br><span class=line>    &#125;),</span><br><span class=line>    <span class=comment>// This instance extracts shared chunks from code splitted chunks and bundles them</span></span><br><span class=line>    <span class=comment>// in a separate chunk, similar to the vendor chunk</span></span><br><span class=line>    <span class=comment>// see: https://webpack.js.org/plugins/commons-chunk-plugin/#extra-async-commons-chunk</span></span><br><span class=line>    <span class=keyword>new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class=line>      name: <span class=string>'app'</span>,</span><br><span class=line>      <span class=keyword>async</span>: <span class=string>'vendor-async'</span>,</span><br><span class=line>      children: <span class=literal>true</span>,</span><br><span class=line>      minChunks: <span class=number>3</span></span><br><span class=line>    &#125;),</span><br><span class=line></span><br><span class=line>    <span class=comment>// 在webpack中拷贝文件和文件夹</span></span><br><span class=line>    <span class=comment>// 传送门:https://doc.webpack-china.org/plugins/copy-webpack-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line>    <span class=comment>// copy custom static assets</span></span><br><span class=line>    <span class=keyword>new</span> CopyWebpackPlugin([</span><br><span class=line>      &#123;</span><br><span class=line>        <span class=keyword>from</span>: path.resolve(__dirname, <span class=string>'../static'</span>),</span><br><span class=line>        to: config.build.assetsSubDirectory,</span><br><span class=line>        ignore: [<span class=string>'.*'</span>]</span><br><span class=line>      &#125;</span><br><span class=line>    ])</span><br><span class=line>  ]</span><br><span class=line>&#125;)</span><br><span class=line></span><br><span class=line><span class=comment>// 提供带 Content-Encoding 编码的压缩版的资源</span></span><br><span class=line><span class=comment>// 传送门:https://doc.webpack-china.org/plugins/compression-webpack-plugin/#src/components/Sidebar/Sidebar.jsx</span></span><br><span class=line><span class=keyword>if</span> (config.build.productionGzip) &#123;</span><br><span class=line>  <span class=keyword>const</span> CompressionWebpackPlugin = <span class=built_in>require</span>(<span class=string>'compression-webpack-plugin'</span>)</span><br><span class=line></span><br><span class=line>  webpackConfig.plugins.push(</span><br><span class=line>    <span class=keyword>new</span> CompressionWebpackPlugin(&#123;</span><br><span class=line>      asset: <span class=string>'[path].gz[query]'</span>,</span><br><span class=line>      algorithm: <span class=string>'gzip'</span>,</span><br><span class=line>      test: <span class=keyword>new</span> <span class=built_in>RegExp</span>(</span><br><span class=line>        <span class=string>'\\.('</span> +</span><br><span class=line>        config.build.productionGzipExtensions.join(<span class=string>'|'</span>) +</span><br><span class=line>        <span class=string>')$'</span></span><br><span class=line>      ),</span><br><span class=line>      threshold: <span class=number>10240</span>,</span><br><span class=line>      minRatio: <span class=number>0.8</span></span><br><span class=line>    &#125;)</span><br><span class=line>  )</span><br><span class=line>&#125;</span><br><span class=line><span class=comment>// 分析 bundle 内容的插件及 CLI 工具，以便捷的、交互式、可缩放的树状图形式展现给用户。</span></span><br><span class=line><span class=comment>// 传送门:https://github.com/webpack-contrib/webpack-bundle-analyzer</span></span><br><span class=line><span class=keyword>if</span> (config.build.bundleAnalyzerReport) &#123;</span><br><span class=line>  <span class=keyword>const</span> BundleAnalyzerPlugin = <span class=built_in>require</span>(<span class=string>'webpack-bundle-analyzer'</span>).BundleAnalyzerPlugin</span><br><span class=line>  webpackConfig.plugins.push(<span class=keyword>new</span> BundleAnalyzerPlugin())</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=built_in>module</span>.exports = webpackConfig</span><br></pre></td></tr></table></figure><h3 id=参考><a href=#参考 class=headerlink title=参考></a>参考</h3><p><span class=exturl data-url="aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaG9uZ2NoaC9hcnRpY2xlL2RldGFpbHMvNTUxMTM3NTE=" title=http://blog.csdn.net/hongchh/article/details/55113751>vue-cli的webpack模板项目配置文件分析<i class="fa fa-external-link"></i></span><br><span class=exturl data-url="aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAwODY0NDgzMA==" title=https://segmentfault.com/a/1190000008644830>vue-cli webpack配置分析<i class="fa fa-external-link"></i></span><br><span class=exturl data-url=aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vaG9uZ2RpYW5kaWFuL3AvODMxOTUxNC5odG1s title=https://www.cnblogs.com/hongdiandian/p/8319514.html>vue-cli脚手架之webpack.prod.conf.js<i class="fa fa-external-link"></i></span><br><span class=exturl data-url="aHR0cDovL3d3dy5qYjUxLm5ldC9hcnRpY2xlLzEyODgzOC5odG0=" title=http://www.jb51.net/article/128838.htm>浅谈Vue-cli 命令行工具分析<i class="fa fa-external-link"></i></span></p></div><div><div><div style=text-align:center;color:#ccc;font-size:14px>-------------本文结束<i class="fa fa-paw"></i> 感谢您的阅读-------------</div></div></div><div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>谢谢你请我吃糖果！</div><button id=rewardButton disable=enable onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'><span>打赏</span></button><div id=QR style=display:none><div id=wechat style=display:inline-block><img id=wechat_qr src=/images/wechatpay.jpg alt="King Mui 微信支付"><p>微信支付</p></div><div id=alipay style=display:inline-block><img id=alipay_qr src=/images/alipay.jpg alt="King Mui 支付宝"><p>支付宝</p></div></div></div></div><footer class=post-footer><div class=post-tags><a href=/tags/Vue/ rel=tag><i class="fa fa-tags"></i> Vue</a><a href=/tags/webpack/ rel=tag><i class="fa fa-tags"></i> webpack</a></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/2018/05/05/什么是闭包/ rel=next title=什么是闭包？><i class="fa fa-chevron-left"></i> 什么是闭包？</a></div><span class=post-nav-divider></span><div class="post-nav-prev post-nav-item"><a href=/2018/05/29/filepond简介/ rel=prev title=filepond简介>filepond简介<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class=comments id=comments><div id=lv-container data-id=city data-uid=MTAyMC8zNTE2MS8xMTY5Ng></div></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>文章目录</li><li class=sidebar-nav-overview data-target=site-overview-wrap>站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class=site-overview><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src="//avatars2.githubusercontent.com/u/24365000?s=460&v=4" alt="King Mui"><p class=site-author-name itemprop=name>King Mui</p><p class="site-description motion-element" itemprop=description>原来我和我的影子都在偷偷的哭泣</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/archives/ ><span class=site-state-item-count>23</span> <span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/index.html><span class=site-state-item-count>15</span> <span class=site-state-item-name>标签</span></a></div></nav><div class="feed-link motion-element"><a href=/atom.xml rel=alternate><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9naXRodWIuY29tL2tpbmdtdWk=" title="GitHub &rarr; https://github.com/kingmui"><i class="fa fa-fw fa-github-alt"></i></span></span><span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9LaW5nX19NdWk=" title="Twitter &rarr; https://twitter.com/King__Mui"><i class="fa fa-fw fa-twitter"></i></span></span><span class=links-of-author-item><span class=exturl data-url=aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL2tpbmdtdWkubWVp title="FB Page &rarr; https://www.facebook.com/kingmui.mei"><i class="fa fa-fw fa-facebook-official"></i></span></span><span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS9raW5nX19tdWk=" title="Instagram &rarr; https://www.instagram.com/king__mui"><i class="fa fa-fw fa-instagram"></i></span></span></div><div class="cc-license motion-element" itemprop=license><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLW5kLzQuMC8="><img src=/images/cc-by-nc-nd.svg alt="Creative Commons"></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class=post-toc><div class=post-toc-content><ol class=nav><li class="nav-item nav-level-3"><a class=nav-link href=#主体结构><span class=nav-number>1.</span> <span class=nav-text>主体结构</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#package-json><span class=nav-number>1.1.</span> <span class=nav-text>package.json</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#postcssrc-js><span class=nav-number>1.2.</span> <span class=nav-text>.postcssrc.js</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#babelrc><span class=nav-number>1.3.</span> <span class=nav-text>.babelrc</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#src内文件><span class=nav-number>1.4.</span> <span class=nav-text>src内文件</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#其他文件><span class=nav-number>1.5.</span> <span class=nav-text>其他文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class=nav-link href=#config文件夹><span class=nav-number>2.</span> <span class=nav-text>config文件夹</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#dev-env-js><span class=nav-number>2.1.</span> <span class=nav-text>dev.env.js</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#prod-env-js><span class=nav-number>2.2.</span> <span class=nav-text>prod.env.js</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#index-js><span class=nav-number>2.3.</span> <span class=nav-text>index.js</span></a></li></ol></li><li class="nav-item nav-level-3"><a class=nav-link href=#build文件夹><span class=nav-number>3.</span> <span class=nav-text>build文件夹</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#build-js><span class=nav-number>3.1.</span> <span class=nav-text>build.js</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#check-versions-js><span class=nav-number>3.2.</span> <span class=nav-text>check-versions.js</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#utils-js><span class=nav-number>3.3.</span> <span class=nav-text>utils.js</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#vue-loader-conf-js><span class=nav-number>3.4.</span> <span class=nav-text>vue-loader.conf.js</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#webpack-base-conf-js><span class=nav-number>3.5.</span> <span class=nav-text>webpack.base.conf.js</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#webpack-dev-conf-js><span class=nav-number>3.6.</span> <span class=nav-text>webpack.dev.conf.js</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#webpack-prod-conf-js><span class=nav-number>3.7.</span> <span class=nav-text>webpack.prod.conf.js</span></a></li></ol></li><li class="nav-item nav-level-3"><a class=nav-link href=#参考><span class=nav-number>4.</span> <span class=nav-text>参考</span></a></li></ol></div></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span class=exturl data-url=aHR0cDovL3d3dy5taWl0YmVpYW4uZ292LmNu>浙ICP备18010341号</span> &copy; <span itemprop=copyrightYear>2019</span><span class=with-love id=animate><i class="fa fa-heart"></i></span> <span class=author itemprop=copyrightHolder>KINGMUI</span></div><div class=busuanzi-count><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span class=site-uv title=总访客量><i class="fa fa-user"></i><span class=busuanzi-value id=busuanzi_value_site_uv></span></span><span class=site-pv title=总访问量><i class="fa fa-eye"></i><span class=busuanzi-value id=busuanzi_value_site_pv></span></span></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i> <span id=scrollpercent><span>0</span>%</span></div><div><div class=addthis_inline_share_toolbox><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5ab5cdede089665e" async=async></script></div></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script id=ribbon size=300 alpha=0.6 zindex=-1 src=/lib/canvas-ribbon/canvas-ribbon.js></script><script src=/lib/reading_progress/reading_progress.js></script><script src="/js/src/utils.js?v=6.5.0"></script><script src="/js/src/motion.js?v=6.5.0"></script><script src="/js/src/affix.js?v=6.5.0"></script><script src="/js/src/schemes/pisces.js?v=6.5.0"></script><script src="/js/src/scrollspy.js?v=6.5.0"></script><script src="/js/src/post-details.js?v=6.5.0"></script><script src="/js/src/bootstrap.js?v=6.5.0"></script><script>window.livereOptions={refer:"2018/05/27/vue-cli脚手架中webpack配置基础文件详解/"},function(e,t){var n,r=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((n=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,r.parentNode.insertBefore(n,r))}(document,"script")</script><link rel=stylesheet href=/lib/algolia-instant-search/instantsearch.min.css><script src=/lib/algolia-instant-search/instantsearch.min.js></script><script src="/js/src/algolia-search.js?v=6.5.0"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/src/exturl.js?v=6.5.0"></script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();var o=document.execCommand("copy");document.body.removeChild(n),o?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script></body></html>